import{a as m,j as R}from"./jsx-runtime-e43ccb36.js";import{r as c}from"./index-1b03fe98.js";import{S as ve}from"./StoryTemplate-a36d369e.js";import{d as ye,s as F}from"./ddsReferenceTokens-f9f5a4e4.js";import{C as he,bt as be}from"./libraryAdd-9af098d3.js";import"./Icon-a656622e.js";import{d as K,i as ce}from"./BaseComponentProps-9c025471.js";import"./Caption-6d408196.js";import"./Heading-5f7faa2b.js";import{L as Fe}from"./Label-9dee7f37.js";import"./Legend-41f9f05c.js";import"./Link-1567bf4e.js";import"./Paragraph-998f64b8.js";import"./TextOverflowEllipsis-1edb8626.js";import"./Typography-e857479c.js";import{I as de}from"./InputMessage-b51d1fc9.js";import{B as ue}from"./Button-7e6f5e0d.js";import{V as xe}from"./VisuallyHidden-297bf54e.js";const{colors:E,spacing:w}=ye,h={borderColor:E.DdsColorNeutralsGray5,borderColorError:E.DdsColorDangerBase,paddingLeftRightTop:w.SizesDdsSpacingLocalX15,paddingBottom:w.SizesDdsSpacingLocalX2,gap:w.SizesDdsSpacingLocalX1,backgroundColor:E.DdsColorNeutralsWhite,dragActive:{borderColor:E.DdsColorInteractiveBase,backgroundColor:E.DdsColorInteractiveLightest}},k={marginTop:w.SizesDdsSpacingLocalX05,paddingLeftRight:w.SizesDdsSpacingLocalX05,paddingTopBottom:w.SizesDdsSpacingLayoutX1,backgroundColor:E.DdsColorNeutralsGray1,textToIconsGap:w.SizesDdsSpacingLocalX075,invalid:{borderColor:E.DdsColorDangerBase}},we={gap:w.SizesDdsSpacingLocalX025},Y=F.div`
  display: flex;
  flex-direction: column;
  gap: ${we.gap};
`,B=e=>{const{errors:r}=e;return r.length<1?null:m(Y,{children:r.map(({id:t,message:n})=>m(de,{id:t,message:n,messageType:"error"},t))})};try{Y.displayName="MessageContainer",Y.__docgenInfo={description:"",displayName:"MessageContainer",props:{}}}catch{}try{B.displayName="ErrorList",B.__docgenInfo={description:"",displayName:"ErrorList",props:{errors:{defaultValue:null,description:"",name:"errors",required:!0,type:{name:"{ id: string | undefined; message: string; }[]"}}}}}catch{}const ke=F.li``,Ee=F.span`
  word-break: break-all;
`,Ce=F.div`
  border-width: 2px;
  border-style: solid;
  border-color: ${({isValid:e})=>e?k.backgroundColor:k.invalid.borderColor};
  margin-top: ${k.marginTop};
  padding: ${k.paddingLeftRight} ${k.paddingTopBottom};
  background-color: ${k.backgroundColor};
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: ${k.textToIconsGap};
`,_e=F(ue)`
  padding: 0;
`,J=e=>{const{parentId:r,index:t,file:n,removeFile:a,isValid:i}=e,l=n.errors.map((s,v)=>({id:K(r,`file-${t}-error-${v}`),message:s}));return R(ke,{children:[R(Ce,{...e,children:[m(Ee,{children:n.file.name}),m(_e,{size:"small",appearance:"borderless",purpose:"secondary",type:"button",onClick:a,icon:he,htmlProps:{"aria-label":`Fjern fil, ${n.file.name}`,"aria-invalid":i?void 0:!0,"aria-errormessage":i?void 0:"Ugyldig fil","aria-describedby":ce(l.map(s=>s.id))}})]}),m(B,{errors:l})]},n.file.name)};try{J.displayName="File",J.__docgenInfo={description:"",displayName:"File",props:{parentId:{defaultValue:null,description:"",name:"parentId",required:!0,type:{name:"string"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},isValid:{defaultValue:null,description:"",name:"isValid",required:!0,type:{name:"boolean"}},file:{defaultValue:null,description:"",name:"file",required:!0,type:{name:"FileUploaderFile"}},removeFile:{defaultValue:null,description:"",name:"removeFile",required:!0,type:{name:"() => void"}}}}}catch{}const De=(e,r)=>{switch(r.type){case"focus":return{...e,isFocused:!0};case"blur":return{...e,isFocused:!1};case"dragEnter":return{...e,isDragActive:!0};case"dragLeave":return{...e,isDragActive:!1};case"onSetFiles":return{...e,isDragActive:!1,files:r.payload};case"onRemoveFile":return{...e,files:r.payload};case"setRootErrors":return{...e,rootErrors:r.payload};default:return e}};function S(e,r,t,n){function a(i){return i instanceof t?i:new t(function(l){l(i)})}return new(t||(t=Promise))(function(i,l){function s(u){try{o(n.next(u))}catch(f){l(f)}}function v(u){try{o(n.throw(u))}catch(f){l(f)}}function o(u){u.done?i(u.value):a(u.value).then(s,v)}o((n=n.apply(e,r||[])).next())})}function L(e,r){var t={label:0,sent:function(){if(i[0]&1)throw i[1];return i[1]},trys:[],ops:[]},n,a,i,l;return l={next:s(0),throw:s(1),return:s(2)},typeof Symbol=="function"&&(l[Symbol.iterator]=function(){return this}),l;function s(o){return function(u){return v([o,u])}}function v(o){if(n)throw new TypeError("Generator is already executing.");for(;l&&(l=0,o[0]&&(t=0)),t;)try{if(n=1,a&&(i=o[0]&2?a.return:o[0]?a.throw||((i=a.return)&&i.call(a),0):a.next)&&!(i=i.call(a,o[1])).done)return i;switch(a=0,i&&(o=[o[0]&2,i.value]),o[0]){case 0:case 1:i=o;break;case 4:return t.label++,{value:o[1],done:!1};case 5:t.label++,a=o[1],o=[0];continue;case 7:o=t.ops.pop(),t.trys.pop();continue;default:if(i=t.trys,!(i=i.length>0&&i[i.length-1])&&(o[0]===6||o[0]===2)){t=0;continue}if(o[0]===3&&(!i||o[1]>i[0]&&o[1]<i[3])){t.label=o[1];break}if(o[0]===6&&t.label<i[1]){t.label=i[1],i=o;break}if(i&&t.label<i[2]){t.label=i[2],t.ops.push(o);break}i[2]&&t.ops.pop(),t.trys.pop();continue}o=r.call(e,t)}catch(u){o=[6,u],a=0}finally{n=i=0}if(o[0]&5)throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}}function Z(e,r){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var n=t.call(e),a,i=[],l;try{for(;(r===void 0||r-- >0)&&!(a=n.next()).done;)i.push(a.value)}catch(s){l={error:s}}finally{try{a&&!a.done&&(t=n.return)&&t.call(n)}finally{if(l)throw l.error}}return i}function ee(e,r,t){if(t||arguments.length===2)for(var n=0,a=r.length,i;n<a;n++)(i||!(n in r))&&(i||(i=Array.prototype.slice.call(r,0,n)),i[n]=r[n]);return e.concat(i||Array.prototype.slice.call(r))}var Se=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]);function j(e,r){var t=Le(e);if(typeof t.path!="string"){var n=e.webkitRelativePath;Object.defineProperty(t,"path",{value:typeof r=="string"?r:typeof n=="string"&&n.length>0?n:e.name,writable:!1,configurable:!1,enumerable:!0})}return t}function Le(e){var r=e.name,t=r&&r.lastIndexOf(".")!==-1;if(t&&!e.type){var n=r.split(".").pop().toLowerCase(),a=Se.get(n);a&&Object.defineProperty(e,"type",{value:a,writable:!1,configurable:!1,enumerable:!0})}return e}var Te=[".DS_Store","Thumbs.db"];function re(e){return S(this,void 0,void 0,function(){return L(this,function(r){return N(e)&&Ie(e.dataTransfer)?[2,ze(e.dataTransfer,e.type)]:Re(e)?[2,je(e)]:Array.isArray(e)&&e.every(function(t){return"getFile"in t&&typeof t.getFile=="function"})?[2,qe(e)]:[2,[]]})})}function Ie(e){return N(e)}function Re(e){return N(e)&&N(e.target)}function N(e){return typeof e=="object"&&e!==null}function je(e){return Q(e.target.files).map(function(r){return j(r)})}function qe(e){return S(this,void 0,void 0,function(){var r;return L(this,function(t){switch(t.label){case 0:return[4,Promise.all(e.map(function(n){return n.getFile()}))];case 1:return r=t.sent(),[2,r.map(function(n){return j(n)})]}})})}function ze(e,r){return S(this,void 0,void 0,function(){var t,n;return L(this,function(a){switch(a.label){case 0:return e.items?(t=Q(e.items).filter(function(i){return i.kind==="file"}),r!=="drop"?[2,t]:[4,Promise.all(t.map(Me))]):[3,2];case 1:return n=a.sent(),[2,te(fe(n))];case 2:return[2,te(Q(e.files).map(function(i){return j(i)}))]}})})}function te(e){return e.filter(function(r){return Te.indexOf(r.name)===-1})}function Q(e){if(e===null)return[];for(var r=[],t=0;t<e.length;t++){var n=e[t];r.push(n)}return r}function Me(e){if(typeof e.webkitGetAsEntry!="function")return ie(e);var r=e.webkitGetAsEntry();return r&&r.isDirectory?me(r):ie(e)}function fe(e){return e.reduce(function(r,t){return ee(ee([],Z(r),!1),Z(Array.isArray(t)?fe(t):[t]),!1)},[])}function ie(e){var r=e.getAsFile();if(!r)return Promise.reject("".concat(e," is not a File"));var t=j(r);return Promise.resolve(t)}function $e(e){return S(this,void 0,void 0,function(){return L(this,function(r){return[2,e.isDirectory?me(e):Ae(e)]})})}function me(e){var r=e.createReader();return new Promise(function(t,n){var a=[];function i(){var l=this;r.readEntries(function(s){return S(l,void 0,void 0,function(){var v,o,u;return L(this,function(f){switch(f.label){case 0:if(s.length)return[3,5];f.label=1;case 1:return f.trys.push([1,3,,4]),[4,Promise.all(a)];case 2:return v=f.sent(),t(v),[3,4];case 3:return o=f.sent(),n(o),[3,4];case 4:return[3,6];case 5:u=Promise.all(s.map($e)),a.push(u),i(),f.label=6;case 6:return[2]}})})},function(s){n(s)})}i()})}function Ae(e){return S(this,void 0,void 0,function(){return L(this,function(r){return[2,new Promise(function(t,n){e.file(function(a){var i=j(a,e.fullPath);t(i)},function(a){n(a)})})]})})}var Ve=function(e,r){if(e&&r){var t=Array.isArray(r)?r:r.split(","),n=e.name||"",a=(e.type||"").toLowerCase(),i=a.replace(/\/.*$/,"");return t.some(function(l){var s=l.trim().toLowerCase();return s.charAt(0)==="."?n.toLowerCase().endsWith(s):s.endsWith("/*")?i===s.replace(/\/.*$/,""):a===s})}return!0};const X=e=>{e.preventDefault(),e.stopPropagation()},Pe=e=>e.dataTransfer!==void 0,H=e=>Pe(e)?e.dataTransfer.types.includes("Files")||e.dataTransfer.types.includes("application/x-moz-file"):e.target.files!==null&&e.target.files!==void 0,ne=(e,r)=>r!==void 0?Ve(e,r):!0,Ue=e=>`For mange filer, maks ${e}stk`,ae=()=>"Ugyldig filtype",oe=(e,r,t)=>{const n=[];return r&&r>=1&&e.length>r&&n.push(Ue(r)),t&&n.push(t),n},Oe=e=>{const{initialFiles:r,value:t,onChange:n,accept:a,maxFiles:i,disabled:l,errorMessage:s}=e,v=c.useRef(null),o=c.useRef(null),u=c.useRef(null),f=!!t,q=c.useMemo(()=>(r??[]).map(p=>({file:p,errors:[]})),[r]),[z,d]=c.useReducer(De,{files:q,isFocused:!1,isFileDialogActive:!1,isDragActive:!1,rootErrors:oe(q,i,s)}),{files:b}=z;c.useEffect(()=>{if(f){const p=t.map(y=>{const g=ne(y,a);return{file:y,errors:g?[]:[ae()]}});d({type:"onSetFiles",payload:p})}},[t,f,a,d]),c.useEffect(()=>{d({type:"setRootErrors",payload:oe(b,i,s)})},[d,b,i,s]);const M=c.useCallback(()=>d({type:"focus"}),[d]),T=c.useCallback(()=>d({type:"blur"}),[d]),$=c.useCallback(async p=>{if(X(p),H(p)){if((await re(p)).length===0)return;d({type:"dragEnter"})}},[d,a,i]),A=c.useCallback(p=>{if(X(p),H(p)&&p.dataTransfer)try{p.dataTransfer.dropEffect="copy"}catch{}},[]),W=c.useCallback(p=>{X(p),!p.currentTarget.contains(p.relatedTarget)&&d({type:"dragLeave"})},[d]),_=c.useCallback(async p=>{if(p.preventDefault(),H(p)){const y=b.map(x=>x.file.name),D=(await re(p)).filter(x=>!y.includes(x.name)).map(x=>{const ge=ne(x,a);return{file:x,errors:ge?[]:[ae()]}}).concat(b);n(D.map(x=>x.file)),f||d({type:"onSetFiles",payload:D})}},[b,f,a,s,i,n,d]),V=c.useCallback(()=>{o.current&&(o.current.value="",o.current.click())},[o]),P=c.useCallback(p=>{const y=[...b];y.splice(b.indexOf(p),1),n(y.map(g=>g.file)),f||d({type:"onRemoveFile",payload:y})},[b,f,i,s,n,d]),U=c.useCallback(()=>({onBlur:T,onFocus:M,onDragEnter:$,onDragOver:A,onDragLeave:W,onDrop:_,ref:v}),[T,M,$,A,_,v,l]),G=c.useCallback(()=>({onClick:V,ref:u}),[V,u]),O=c.useCallback(()=>({type:"file",style:{display:"none"},tabIndex:-1,ref:o,onChange:_,multiple:!i||i>1,...a?{accept:a.join(",")}:{}}),[o,_,i,a]);return{state:z,getRootProps:U,getInputProps:O,getButtonProps:G,removeFile:P}},Be="320px",Ne=F.div`
  width: ${({width:e})=>e||Be};
`,We=F.div`
  box-sizing: border-box;
  border-width: ${({hasRootErrors:e})=>e?"2px":"1px"};
  border-style: dashed;
  border-color: ${({isDragActive:e,hasRootErrors:r})=>e?h.dragActive.borderColor:r?h.borderColorError:h.borderColor};
  padding: ${({hasRootErrors:e})=>e?`calc(${h.paddingLeftRightTop} - 1px) calc(${h.paddingLeftRightTop} - 1px) ${h.paddingBottom}`:`${h.paddingLeftRightTop} ${h.paddingLeftRightTop} ${h.paddingBottom}`};
  display: flex;
  flex-direction: column;
  gap: ${h.gap};
  background-color: ${({isDragActive:e})=>e?h.dragActive.backgroundColor:h.backgroundColor};
`,Ge=F.input``,Xe=F.ul`
  margin: 0;
  padding: 0;
  list-style-type: none;
`,C=e=>{const{id:r,label:t,tip:n,required:a=!1,initialFiles:i,value:l,accept:s,maxFiles:v,disabled:o,onChange:u,width:f,errorMessage:q}=e,z=c.useId(),d=r??`${z}-fileUploader`,{state:{files:b,isDragActive:M,rootErrors:T},getRootProps:$,getInputProps:A,getButtonProps:W,removeFile:_}=Oe({id:r,initialFiles:i,value:l,onChange:u,accept:s,disabled:o,maxFiles:v,errorMessage:q}),V=t!==void 0,P=n!==void 0,U=T.length>0,G=a,O=K(d,"tip"),p=b.map((g,D)=>m(J,{parentId:d,index:D,file:g,isValid:g.errors.length===0,removeFile:()=>_(g)},g.file.name)),y=T.map((g,D)=>({id:K(d,`error-${D}`),message:g}));return R(Ne,{width:f,children:[V&&m(Fe,{showRequiredStyling:G,htmlFor:d,children:t}),P&&m(de,{id:O,message:n,messageType:"tip"}),R(We,{...$(),isDragActive:M,hasRootErrors:U,children:[m(Ge,{...A()}),"Dra og slipp filer her eller"," ",m(xe,{as:"span",children:"velg fil med påfølgende knapp"}),m(ue,{...W(),id:d,size:"medium",type:"button",appearance:"filled",purpose:"secondary",icon:be,htmlProps:{"aria-invalid":U?!0:void 0,"aria-describedby":ce([P?O:void 0,...y.map(g=>g.id)])},children:"Velg fil"})]}),m(B,{errors:y}),m(Xe,{children:p})]})};C.displayName="FileUploader";try{C.displayName="FileUploader",C.__docgenInfo={description:"",displayName:"FileUploader",props:{id:{defaultValue:null,description:"Id til filopplasteren.",name:"id",required:!1,type:{name:"string | undefined"}},label:{defaultValue:null,description:"Ledetekst for filopplaster.",name:"label",required:!1,type:{name:"string | undefined"}},tip:{defaultValue:null,description:"Hjelpetekst.",name:"tip",required:!1,type:{name:"string | undefined"}},required:{defaultValue:null,description:"Om det er påkrevd med minst en fil.",name:"required",required:!1,type:{name:"boolean | undefined"}},onChange:{defaultValue:null,description:"Callback for når fil-listen endres.",name:"onChange",required:!0,type:{name:"((newFiles: FileList) => void) & ((newFiles: FileList) => void)"}},width:{defaultValue:null,description:"Bredde for filopplasteren.",name:"width",required:!1,type:{name:"Width<string> | undefined"}},initialFiles:{defaultValue:null,description:"Dersom komponenten skal styres internt. Utgangspunktet for filene som har blitt lastet opp.",name:"initialFiles",required:!1,type:{name:"FileList | undefined"}},value:{defaultValue:null,description:"Dersom komponenten styres utenfra. Filene som har blitt lastet opp.",name:"value",required:!1,type:{name:"FileList | undefined"}},accept:{defaultValue:null,description:"Hvilke filendelser eller mime-typer som filopplasteren skal akseptere.",name:"accept",required:!1,type:{name:"Accept[] | undefined"}},disabled:{defaultValue:null,description:"Om filopplasteren er avslått eller ikke",name:"disabled",required:!1,type:{name:"boolean | undefined"}},maxFiles:{defaultValue:null,description:"Maks antall filer som tillates.",name:"maxFiles",required:!1,type:{name:"number | undefined"}},errorMessage:{defaultValue:null,description:"Feilmelding. Setter også error state.",name:"errorMessage",required:!1,type:{name:"string | undefined"}}}}}catch{}const He={title:"dds-components/FileUploader BETA",component:C,argTypes:{color:{control:{type:"text"}},size:{control:{type:"text"}}}},Ke=()=>{const[e,r]=c.useState([]);return m(C,{label:"Last opp fil",tip:"Maks 1",required:!0,initialFiles:e,onChange:t=>{r(t)},maxFiles:1})},Ye=()=>{const[e,r]=c.useState([]);return m(C,{label:"Last opp PDF",tip:"Kun pdf-filer. Maks 2",required:!0,initialFiles:e,onChange:t=>{r(t)},accept:[".pdf","application/pdf"],maxFiles:2})},Je=()=>{const[e,r]=c.useState([]),[t,n]=c.useState("");return c.useEffect(()=>{setTimeout(()=>{n("Feilmelding som kommer etter 3 sek.")},3e3)},[]),m(C,{label:"Last opp",tip:"Maks 2",required:!0,initialFiles:e,onChange:a=>{r(a)},errorMessage:t,maxFiles:2})},I=()=>R(ve,{title:"FileUploader - overview",children:[m(Ke,{}),m(Ye,{}),m(Je,{})]});var se,le,pe;I.parameters={...I.parameters,docs:{...(se=I.parameters)==null?void 0:se.docs,source:{originalSource:`() => {
  return <StoryTemplate title="FileUploader - overview">
      <SingleFileUploader />
      <PdfUploader />
      <WithErrorMessage />
    </StoryTemplate>;
}`,...(pe=(le=I.parameters)==null?void 0:le.docs)==null?void 0:pe.source}}};const Qe=["Overview"],yr=Object.freeze(Object.defineProperty({__proto__:null,Overview:I,__namedExportsOrder:Qe,default:He},Symbol.toStringTag,{value:"Module"}));export{yr as F,I as O};
//# sourceMappingURL=FileUploader.stories-921e6d44.js.map
