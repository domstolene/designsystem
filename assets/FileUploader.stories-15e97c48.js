import{a as d,j as R}from"./jsx-runtime-e43ccb36.js";import{r as s}from"./index-1b03fe98.js";import{S as ve}from"./StoryTemplate-f63f16be.js";import{d as ye,s as b,_ as L,b as T,c as Z,e as ee}from"./ddsReferenceTokens-cf345c8b.js";import{C as he,bt as be}from"./libraryAdd-bb03a5d3.js";import"./Icon-feef9230.js";import{d as K,i as de}from"./BaseComponentProps-c04e3b0f.js";import"./Caption-c95a25e6.js";import"./Heading-eb094a5f.js";import{L as Fe}from"./Label-7698c3d3.js";import"./Legend-90ca2ccd.js";import"./Link-a0d6f9b6.js";import"./Paragraph-74ee9681.js";import"./TextOverflowEllipsis-a0e35774.js";import"./Typography-8df5b43e.js";import{I as ce}from"./InputMessage-0bc16530.js";import{B as ue}from"./Button-db658d75.js";import{V as xe}from"./VisuallyHidden-305031f2.js";const{colors:w,spacing:x}=ye,m={borderColor:w.DdsColorNeutralsGray5,borderColorError:w.DdsColorDangerBase,paddingLeftRightTop:x.SizesDdsSpacingLocalX15,paddingBottom:x.SizesDdsSpacingLocalX2,gap:x.SizesDdsSpacingLocalX1,backgroundColor:w.DdsColorNeutralsWhite,dragActive:{borderColor:w.DdsColorInteractiveBase,backgroundColor:w.DdsColorInteractiveLightest}},C={marginTop:x.SizesDdsSpacingLocalX05,paddingLeftRight:x.SizesDdsSpacingLocalX05,paddingTopBottom:x.SizesDdsSpacingLayoutX1,backgroundColor:w.DdsColorNeutralsGray1,textToIconsGap:x.SizesDdsSpacingLocalX075,invalid:{borderColor:w.DdsColorDangerBase}},ke={gap:x.SizesDdsSpacingLocalX025},Y=b.div`
  display: flex;
  flex-direction: column;
  gap: ${ke.gap};
`,B=e=>{const{errors:r}=e;return r.length<1?null:d(Y,{children:r.map(({id:t,message:i})=>d(ce,{id:t,message:i,messageType:"error"},t))})};try{Y.displayName="MessageContainer",Y.__docgenInfo={description:"",displayName:"MessageContainer",props:{}}}catch{}try{B.displayName="ErrorList",B.__docgenInfo={description:"",displayName:"ErrorList",props:{errors:{defaultValue:null,description:"",name:"errors",required:!0,type:{name:"{ id: string | undefined; message: string; }[]"}}}}}catch{}const Ce=b.li``,we=b.span`
  word-break: break-all;
`,Ee=b.div`
  border-width: 2px;
  border-style: solid;
  border-color: ${({isValid:e})=>e?C.backgroundColor:C.invalid.borderColor};
  margin-top: ${C.marginTop};
  padding: ${C.paddingLeftRight} ${C.paddingTopBottom};
  background-color: ${C.backgroundColor};
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: ${C.textToIconsGap};
`,_e=b(ue)`
  padding: 0;
`,J=e=>{const{parentId:r,index:t,file:i,removeFile:a,isValid:n}=e,v=i.errors.map((l,h)=>({id:K(r,`file-${t}-error-${h}`),message:l}));return R(Ce,{children:[R(Ee,{...e,children:[d(we,{children:i.file.name}),d(_e,{size:"small",appearance:"borderless",purpose:"secondary",type:"button",onClick:a,icon:he,htmlProps:{"aria-label":`Fjern fil, ${i.file.name}`,"aria-invalid":n?void 0:!0,"aria-errormessage":n?void 0:"Ugyldig fil","aria-describedby":de(v.map(l=>l.id))}})]}),d(B,{errors:v})]},i.file.name)};try{J.displayName="File",J.__docgenInfo={description:"",displayName:"File",props:{parentId:{defaultValue:null,description:"",name:"parentId",required:!0,type:{name:"string"}},index:{defaultValue:null,description:"",name:"index",required:!0,type:{name:"number"}},isValid:{defaultValue:null,description:"",name:"isValid",required:!0,type:{name:"boolean"}},file:{defaultValue:null,description:"",name:"file",required:!0,type:{name:"FileUploaderFile"}},removeFile:{defaultValue:null,description:"",name:"removeFile",required:!0,type:{name:"() => void"}}}}}catch{}const De=(e,r)=>{switch(r.type){case"focus":return{...e,isFocused:!0};case"blur":return{...e,isFocused:!1};case"dragEnter":return{...e,isDragActive:!0};case"dragLeave":return{...e,isDragActive:!1};case"onSetFiles":return{...e,isDragActive:!1,files:r.payload};case"onRemoveFile":return{...e,files:r.payload};case"setRootErrors":return{...e,rootErrors:r.payload};default:return e}};var Le=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]);function j(e,r){var t=Te(e);if(typeof t.path!="string"){var i=e.webkitRelativePath;Object.defineProperty(t,"path",{value:typeof r=="string"?r:typeof i=="string"&&i.length>0?i:e.name,writable:!1,configurable:!1,enumerable:!0})}return t}function Te(e){var r=e.name,t=r&&r.lastIndexOf(".")!==-1;if(t&&!e.type){var i=r.split(".").pop().toLowerCase(),a=Le.get(i);a&&Object.defineProperty(e,"type",{value:a,writable:!1,configurable:!1,enumerable:!0})}return e}var Se=[".DS_Store","Thumbs.db"];function re(e){return L(this,void 0,void 0,function(){return T(this,function(r){return N(e)&&Ie(e.dataTransfer)?[2,ze(e.dataTransfer,e.type)]:Re(e)?[2,je(e)]:Array.isArray(e)&&e.every(function(t){return"getFile"in t&&typeof t.getFile=="function"})?[2,qe(e)]:[2,[]]})})}function Ie(e){return N(e)}function Re(e){return N(e)&&N(e.target)}function N(e){return typeof e=="object"&&e!==null}function je(e){return Q(e.target.files).map(function(r){return j(r)})}function qe(e){return L(this,void 0,void 0,function(){var r;return T(this,function(t){switch(t.label){case 0:return[4,Promise.all(e.map(function(i){return i.getFile()}))];case 1:return r=t.sent(),[2,r.map(function(i){return j(i)})]}})})}function ze(e,r){return L(this,void 0,void 0,function(){var t,i;return T(this,function(a){switch(a.label){case 0:return e.items?(t=Q(e.items).filter(function(n){return n.kind==="file"}),r!=="drop"?[2,t]:[4,Promise.all(t.map(Me))]):[3,2];case 1:return i=a.sent(),[2,te(fe(i))];case 2:return[2,te(Q(e.files).map(function(n){return j(n)}))]}})})}function te(e){return e.filter(function(r){return Se.indexOf(r.name)===-1})}function Q(e){if(e===null)return[];for(var r=[],t=0;t<e.length;t++){var i=e[t];r.push(i)}return r}function Me(e){if(typeof e.webkitGetAsEntry!="function")return ie(e);var r=e.webkitGetAsEntry();return r&&r.isDirectory?me(r):ie(e)}function fe(e){return e.reduce(function(r,t){return Z(Z([],ee(r),!1),ee(Array.isArray(t)?fe(t):[t]),!1)},[])}function ie(e){var r=e.getAsFile();if(!r)return Promise.reject("".concat(e," is not a File"));var t=j(r);return Promise.resolve(t)}function $e(e){return L(this,void 0,void 0,function(){return T(this,function(r){return[2,e.isDirectory?me(e):Pe(e)]})})}function me(e){var r=e.createReader();return new Promise(function(t,i){var a=[];function n(){var v=this;r.readEntries(function(l){return L(v,void 0,void 0,function(){var h,g,k;return T(this,function(c){switch(c.label){case 0:if(l.length)return[3,5];c.label=1;case 1:return c.trys.push([1,3,,4]),[4,Promise.all(a)];case 2:return h=c.sent(),t(h),[3,4];case 3:return g=c.sent(),i(g),[3,4];case 4:return[3,6];case 5:k=Promise.all(l.map($e)),a.push(k),n(),c.label=6;case 6:return[2]}})})},function(l){i(l)})}n()})}function Pe(e){return L(this,void 0,void 0,function(){return T(this,function(r){return[2,new Promise(function(t,i){e.file(function(a){var n=j(a,e.fullPath);t(n)},function(a){i(a)})})]})})}var Ve=function(e,r){if(e&&r){var t=Array.isArray(r)?r:r.split(","),i=e.name||"",a=(e.type||"").toLowerCase(),n=a.replace(/\/.*$/,"");return t.some(function(v){var l=v.trim().toLowerCase();return l.charAt(0)==="."?i.toLowerCase().endsWith(l):l.endsWith("/*")?n===l.replace(/\/.*$/,""):a===l})}return!0};const X=e=>{e.preventDefault(),e.stopPropagation()},Ae=e=>e.dataTransfer!==void 0,H=e=>Ae(e)?e.dataTransfer.types.includes("Files")||e.dataTransfer.types.includes("application/x-moz-file"):e.target.files!==null&&e.target.files!==void 0,ae=(e,r)=>r!==void 0?Ve(e,r):!0,Ue=e=>`For mange filer, maks ${e}stk`,ne=()=>"Ugyldig filtype",oe=(e,r,t)=>{const i=[];return r&&r>=1&&e.length>r&&i.push(Ue(r)),t&&i.push(t),i},Oe=e=>{const{initialFiles:r,value:t,onChange:i,accept:a,maxFiles:n,disabled:v,errorMessage:l}=e,h=s.useRef(null),g=s.useRef(null),k=s.useRef(null),c=!!t,q=s.useMemo(()=>(r??[]).map(o=>({file:o,errors:[]})),[r]),[z,p]=s.useReducer(De,{files:q,isFocused:!1,isFileDialogActive:!1,isDragActive:!1,rootErrors:oe(q,n,l)}),{files:y}=z;s.useEffect(()=>{if(c){const o=t.map(f=>{const u=ae(f,a);return{file:f,errors:u?[]:[ne()]}});p({type:"onSetFiles",payload:o})}},[t,c,a,p]),s.useEffect(()=>{p({type:"setRootErrors",payload:oe(y,n,l)})},[p,y,n,l]);const M=s.useCallback(()=>p({type:"focus"}),[p]),S=s.useCallback(()=>p({type:"blur"}),[p]),$=s.useCallback(async o=>{if(X(o),H(o)){if((await re(o)).length===0)return;p({type:"dragEnter"})}},[p,a,n]),P=s.useCallback(o=>{if(X(o),H(o)&&o.dataTransfer)try{o.dataTransfer.dropEffect="copy"}catch{}},[]),W=s.useCallback(o=>{X(o),!o.currentTarget.contains(o.relatedTarget)&&p({type:"dragLeave"})},[p]),_=s.useCallback(async o=>{if(o.preventDefault(),H(o)){const f=y.map(F=>F.file.name),D=(await re(o)).filter(F=>!f.includes(F.name)).map(F=>{const ge=ae(F,a);return{file:F,errors:ge?[]:[ne()]}}).concat(y);i(D.map(F=>F.file)),c||p({type:"onSetFiles",payload:D})}},[y,c,a,l,n,i,p]),V=s.useCallback(()=>{g.current&&(g.current.value="",g.current.click())},[g]),A=s.useCallback(o=>{const f=[...y];f.splice(y.indexOf(o),1),i(f.map(u=>u.file)),c||p({type:"onRemoveFile",payload:f})},[y,c,n,l,i,p]),U=s.useCallback(()=>({onBlur:S,onFocus:M,onDragEnter:$,onDragOver:P,onDragLeave:W,onDrop:_,ref:h}),[S,M,$,P,_,h,v]),G=s.useCallback(()=>({onClick:V,ref:k}),[V,k]),O=s.useCallback(()=>({type:"file",style:{display:"none"},tabIndex:-1,ref:g,onChange:_,multiple:!n||n>1,...a?{accept:a.join(",")}:{}}),[g,_,n,a]);return{state:z,getRootProps:U,getInputProps:O,getButtonProps:G,removeFile:A}},Be="320px",Ne=b.div`
  width: ${({width:e})=>e||Be};
`,We=b.div`
  box-sizing: border-box;
  border-width: ${({hasRootErrors:e})=>e?"2px":"1px"};
  border-style: dashed;
  border-color: ${({isDragActive:e,hasRootErrors:r})=>e?m.dragActive.borderColor:r?m.borderColorError:m.borderColor};
  padding: ${({hasRootErrors:e})=>e?`calc(${m.paddingLeftRightTop} - 1px) calc(${m.paddingLeftRightTop} - 1px) ${m.paddingBottom}`:`${m.paddingLeftRightTop} ${m.paddingLeftRightTop} ${m.paddingBottom}`};
  display: flex;
  flex-direction: column;
  gap: ${m.gap};
  background-color: ${({isDragActive:e})=>e?m.dragActive.backgroundColor:m.backgroundColor};
`,Ge=b.input``,Xe=b.ul`
  margin: 0;
  padding: 0;
  list-style-type: none;
`,E=e=>{const{id:r,label:t,tip:i,required:a=!1,initialFiles:n,value:v,accept:l,maxFiles:h,disabled:g,onChange:k,width:c,errorMessage:q}=e,z=s.useId(),p=r??`${z}-fileUploader`,{state:{files:y,isDragActive:M,rootErrors:S},getRootProps:$,getInputProps:P,getButtonProps:W,removeFile:_}=Oe({id:r,initialFiles:n,value:v,onChange:k,accept:l,disabled:g,maxFiles:h,errorMessage:q}),V=t!==void 0,A=i!==void 0,U=S.length>0,G=a,O=K(p,"tip"),o=y.map((u,D)=>d(J,{parentId:p,index:D,file:u,isValid:u.errors.length===0,removeFile:()=>_(u)},u.file.name)),f=S.map((u,D)=>({id:K(p,`error-${D}`),message:u}));return R(Ne,{width:c,children:[V&&d(Fe,{showRequiredStyling:G,htmlFor:p,children:t}),A&&d(ce,{id:O,message:i,messageType:"tip"}),R(We,{...$(),isDragActive:M,hasRootErrors:U,children:[d(Ge,{...P()}),"Dra og slipp filer her eller"," ",d(xe,{as:"span",children:"velg fil med påfølgende knapp"}),d(ue,{...W(),id:p,size:"medium",type:"button",appearance:"filled",purpose:"secondary",icon:be,htmlProps:{"aria-invalid":U?!0:void 0,"aria-describedby":de([A?O:void 0,...f.map(u=>u.id)])},children:"Velg fil"})]}),d(B,{errors:f}),d(Xe,{children:o})]})};E.displayName="FileUploader";try{E.displayName="FileUploader",E.__docgenInfo={description:"",displayName:"FileUploader",props:{id:{defaultValue:null,description:"Id til filopplasteren.",name:"id",required:!1,type:{name:"string | undefined"}},label:{defaultValue:null,description:"Ledetekst for filopplaster.",name:"label",required:!1,type:{name:"string | undefined"}},tip:{defaultValue:null,description:"Hjelpetekst.",name:"tip",required:!1,type:{name:"string | undefined"}},required:{defaultValue:null,description:"Om det er påkrevd med minst en fil.",name:"required",required:!1,type:{name:"boolean | undefined"}},onChange:{defaultValue:null,description:"Callback for når fil-listen endres.",name:"onChange",required:!0,type:{name:"((newFiles: FileList) => void) & ((newFiles: FileList) => void)"}},width:{defaultValue:null,description:"Bredde for filopplasteren.",name:"width",required:!1,type:{name:"Width<string> | undefined"}},initialFiles:{defaultValue:null,description:"Dersom komponenten skal styres internt. Utgangspunktet for filene som har blitt lastet opp.",name:"initialFiles",required:!1,type:{name:"FileList | undefined"}},value:{defaultValue:null,description:"Dersom komponenten styres utenfra. Filene som har blitt lastet opp.",name:"value",required:!1,type:{name:"FileList | undefined"}},accept:{defaultValue:null,description:"Hvilke filendelser eller mime-typer som filopplasteren skal akseptere.",name:"accept",required:!1,type:{name:"Accept[] | undefined"}},disabled:{defaultValue:null,description:"Om filopplasteren er avslått eller ikke",name:"disabled",required:!1,type:{name:"boolean | undefined"}},maxFiles:{defaultValue:null,description:"Maks antall filer som tillates.",name:"maxFiles",required:!1,type:{name:"number | undefined"}},errorMessage:{defaultValue:null,description:"Feilmelding. Setter også error state.",name:"errorMessage",required:!1,type:{name:"string | undefined"}}}}}catch{}const He={title:"dds-components/FileUploader BETA",component:E,argTypes:{color:{control:{type:"text"}},size:{control:{type:"text"}}}},Ke=()=>{const[e,r]=s.useState([]);return d(E,{label:"Last opp fil",tip:"Maks 1",required:!0,initialFiles:e,onChange:t=>{r(t)},maxFiles:1})},Ye=()=>{const[e,r]=s.useState([]);return d(E,{label:"Last opp PDF",tip:"Kun pdf-filer. Maks 2",required:!0,initialFiles:e,onChange:t=>{r(t)},accept:[".pdf","application/pdf"],maxFiles:2})},Je=()=>{const[e,r]=s.useState([]),[t,i]=s.useState("");return s.useEffect(()=>{setTimeout(()=>{i("Feilmelding som kommer etter 3 sek.")},3e3)},[]),d(E,{label:"Last opp",tip:"Maks 2",required:!0,initialFiles:e,onChange:a=>{r(a)},errorMessage:t,maxFiles:2})},I=()=>R(ve,{title:"FileUploader - overview",children:[d(Ke,{}),d(Ye,{}),d(Je,{})]});var se,le,pe;I.parameters={...I.parameters,docs:{...(se=I.parameters)==null?void 0:se.docs,source:{originalSource:`() => {
  return <StoryTemplate title="FileUploader - overview">
      <SingleFileUploader />
      <PdfUploader />
      <WithErrorMessage />
    </StoryTemplate>;
}`,...(pe=(le=I.parameters)==null?void 0:le.docs)==null?void 0:pe.source}}};const Qe=["Overview"],yr=Object.freeze(Object.defineProperty({__proto__:null,Overview:I,__namedExportsOrder:Qe,default:He},Symbol.toStringTag,{value:"Module"}));export{yr as F,I as O};
//# sourceMappingURL=FileUploader.stories-15e97c48.js.map
