{"version":3,"file":"FileUploader.stories-99bc9d6e.js","sources":["../../../../node_modules/file-selector/dist/es5/file.js","../../../../node_modules/file-selector/dist/es5/file-selector.js","../../../../node_modules/attr-accept/dist/es/index.js","../../../../packages/components/src/components/FileUploader/FileUploader.tokens.tsx","../../../../packages/components/src/components/FileUploader/ErrorList.tsx","../../../../packages/components/src/components/FileUploader/File.tsx","../../../../packages/components/src/components/FileUploader/fileUploaderReducer.ts","../../../../packages/components/src/components/FileUploader/utils.ts","../../../../packages/components/src/components/FileUploader/useFileUploader.ts","../../../../packages/components/src/components/FileUploader/FileUploader.tsx"],"sourcesContent":["export var COMMON_MIME_TYPES = new Map([\n    // https://developer.mozilla.org/en-US/docs/Web/HTTP/Basics_of_HTTP/MIME_types/Common_types\n    ['aac', 'audio/aac'],\n    ['abw', 'application/x-abiword'],\n    ['arc', 'application/x-freearc'],\n    ['avif', 'image/avif'],\n    ['avi', 'video/x-msvideo'],\n    ['azw', 'application/vnd.amazon.ebook'],\n    ['bin', 'application/octet-stream'],\n    ['bmp', 'image/bmp'],\n    ['bz', 'application/x-bzip'],\n    ['bz2', 'application/x-bzip2'],\n    ['cda', 'application/x-cdf'],\n    ['csh', 'application/x-csh'],\n    ['css', 'text/css'],\n    ['csv', 'text/csv'],\n    ['doc', 'application/msword'],\n    ['docx', 'application/vnd.openxmlformats-officedocument.wordprocessingml.document'],\n    ['eot', 'application/vnd.ms-fontobject'],\n    ['epub', 'application/epub+zip'],\n    ['gz', 'application/gzip'],\n    ['gif', 'image/gif'],\n    ['heic', 'image/heic'],\n    ['heif', 'image/heif'],\n    ['htm', 'text/html'],\n    ['html', 'text/html'],\n    ['ico', 'image/vnd.microsoft.icon'],\n    ['ics', 'text/calendar'],\n    ['jar', 'application/java-archive'],\n    ['jpeg', 'image/jpeg'],\n    ['jpg', 'image/jpeg'],\n    ['js', 'text/javascript'],\n    ['json', 'application/json'],\n    ['jsonld', 'application/ld+json'],\n    ['mid', 'audio/midi'],\n    ['midi', 'audio/midi'],\n    ['mjs', 'text/javascript'],\n    ['mp3', 'audio/mpeg'],\n    ['mp4', 'video/mp4'],\n    ['mpeg', 'video/mpeg'],\n    ['mpkg', 'application/vnd.apple.installer+xml'],\n    ['odp', 'application/vnd.oasis.opendocument.presentation'],\n    ['ods', 'application/vnd.oasis.opendocument.spreadsheet'],\n    ['odt', 'application/vnd.oasis.opendocument.text'],\n    ['oga', 'audio/ogg'],\n    ['ogv', 'video/ogg'],\n    ['ogx', 'application/ogg'],\n    ['opus', 'audio/opus'],\n    ['otf', 'font/otf'],\n    ['png', 'image/png'],\n    ['pdf', 'application/pdf'],\n    ['php', 'application/x-httpd-php'],\n    ['ppt', 'application/vnd.ms-powerpoint'],\n    ['pptx', 'application/vnd.openxmlformats-officedocument.presentationml.presentation'],\n    ['rar', 'application/vnd.rar'],\n    ['rtf', 'application/rtf'],\n    ['sh', 'application/x-sh'],\n    ['svg', 'image/svg+xml'],\n    ['swf', 'application/x-shockwave-flash'],\n    ['tar', 'application/x-tar'],\n    ['tif', 'image/tiff'],\n    ['tiff', 'image/tiff'],\n    ['ts', 'video/mp2t'],\n    ['ttf', 'font/ttf'],\n    ['txt', 'text/plain'],\n    ['vsd', 'application/vnd.visio'],\n    ['wav', 'audio/wav'],\n    ['weba', 'audio/webm'],\n    ['webm', 'video/webm'],\n    ['webp', 'image/webp'],\n    ['woff', 'font/woff'],\n    ['woff2', 'font/woff2'],\n    ['xhtml', 'application/xhtml+xml'],\n    ['xls', 'application/vnd.ms-excel'],\n    ['xlsx', 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'],\n    ['xml', 'application/xml'],\n    ['xul', 'application/vnd.mozilla.xul+xml'],\n    ['zip', 'application/zip'],\n    ['7z', 'application/x-7z-compressed'],\n    // Others\n    ['mkv', 'video/x-matroska'],\n    ['mov', 'video/quicktime'],\n    ['msg', 'application/vnd.ms-outlook']\n]);\nexport function toFileWithPath(file, path) {\n    var f = withMimeType(file);\n    if (typeof f.path !== 'string') { // on electron, path is already set to the absolute path\n        var webkitRelativePath = file.webkitRelativePath;\n        Object.defineProperty(f, 'path', {\n            value: typeof path === 'string'\n                ? path\n                // If <input webkitdirectory> is set,\n                // the File will have a {webkitRelativePath} property\n                // https://developer.mozilla.org/en-US/docs/Web/API/HTMLInputElement/webkitdirectory\n                : typeof webkitRelativePath === 'string' && webkitRelativePath.length > 0\n                    ? webkitRelativePath\n                    : file.name,\n            writable: false,\n            configurable: false,\n            enumerable: true\n        });\n    }\n    return f;\n}\nfunction withMimeType(file) {\n    var name = file.name;\n    var hasExtension = name && name.lastIndexOf('.') !== -1;\n    if (hasExtension && !file.type) {\n        var ext = name.split('.')\n            .pop().toLowerCase();\n        var type = COMMON_MIME_TYPES.get(ext);\n        if (type) {\n            Object.defineProperty(file, 'type', {\n                value: type,\n                writable: false,\n                configurable: false,\n                enumerable: true\n            });\n        }\n    }\n    return file;\n}\n//# sourceMappingURL=file.js.map","import { __awaiter, __generator, __read, __spreadArray } from \"tslib\";\nimport { toFileWithPath } from './file';\nvar FILES_TO_IGNORE = [\n    // Thumbnail cache files for macOS and Windows\n    '.DS_Store',\n    'Thumbs.db' // Windows\n];\n/**\n * Convert a DragEvent's DataTrasfer object to a list of File objects\n * NOTE: If some of the items are folders,\n * everything will be flattened and placed in the same list but the paths will be kept as a {path} property.\n *\n * EXPERIMENTAL: A list of https://developer.mozilla.org/en-US/docs/Web/API/FileSystemHandle objects can also be passed as an arg\n * and a list of File objects will be returned.\n *\n * @param evt\n */\nexport function fromEvent(evt) {\n    return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            if (isObject(evt) && isDataTransfer(evt.dataTransfer)) {\n                return [2 /*return*/, getDataTransferFiles(evt.dataTransfer, evt.type)];\n            }\n            else if (isChangeEvt(evt)) {\n                return [2 /*return*/, getInputFiles(evt)];\n            }\n            else if (Array.isArray(evt) && evt.every(function (item) { return 'getFile' in item && typeof item.getFile === 'function'; })) {\n                return [2 /*return*/, getFsHandleFiles(evt)];\n            }\n            return [2 /*return*/, []];\n        });\n    });\n}\nfunction isDataTransfer(value) {\n    return isObject(value);\n}\nfunction isChangeEvt(value) {\n    return isObject(value) && isObject(value.target);\n}\nfunction isObject(v) {\n    return typeof v === 'object' && v !== null;\n}\nfunction getInputFiles(evt) {\n    return fromList(evt.target.files).map(function (file) { return toFileWithPath(file); });\n}\n// Ee expect each handle to be https://developer.mozilla.org/en-US/docs/Web/API/FileSystemFileHandle\nfunction getFsHandleFiles(handles) {\n    return __awaiter(this, void 0, void 0, function () {\n        var files;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0: return [4 /*yield*/, Promise.all(handles.map(function (h) { return h.getFile(); }))];\n                case 1:\n                    files = _a.sent();\n                    return [2 /*return*/, files.map(function (file) { return toFileWithPath(file); })];\n            }\n        });\n    });\n}\nfunction getDataTransferFiles(dt, type) {\n    return __awaiter(this, void 0, void 0, function () {\n        var items, files;\n        return __generator(this, function (_a) {\n            switch (_a.label) {\n                case 0:\n                    if (!dt.items) return [3 /*break*/, 2];\n                    items = fromList(dt.items)\n                        .filter(function (item) { return item.kind === 'file'; });\n                    // According to https://html.spec.whatwg.org/multipage/dnd.html#dndevents,\n                    // only 'dragstart' and 'drop' has access to the data (source node)\n                    if (type !== 'drop') {\n                        return [2 /*return*/, items];\n                    }\n                    return [4 /*yield*/, Promise.all(items.map(toFilePromises))];\n                case 1:\n                    files = _a.sent();\n                    return [2 /*return*/, noIgnoredFiles(flatten(files))];\n                case 2: return [2 /*return*/, noIgnoredFiles(fromList(dt.files)\n                        .map(function (file) { return toFileWithPath(file); }))];\n            }\n        });\n    });\n}\nfunction noIgnoredFiles(files) {\n    return files.filter(function (file) { return FILES_TO_IGNORE.indexOf(file.name) === -1; });\n}\n// IE11 does not support Array.from()\n// https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/from#Browser_compatibility\n// https://developer.mozilla.org/en-US/docs/Web/API/FileList\n// https://developer.mozilla.org/en-US/docs/Web/API/DataTransferItemList\nfunction fromList(items) {\n    if (items === null) {\n        return [];\n    }\n    var files = [];\n    // tslint:disable: prefer-for-of\n    for (var i = 0; i < items.length; i++) {\n        var file = items[i];\n        files.push(file);\n    }\n    return files;\n}\n// https://developer.mozilla.org/en-US/docs/Web/API/DataTransferItem\nfunction toFilePromises(item) {\n    if (typeof item.webkitGetAsEntry !== 'function') {\n        return fromDataTransferItem(item);\n    }\n    var entry = item.webkitGetAsEntry();\n    // Safari supports dropping an image node from a different window and can be retrieved using\n    // the DataTransferItem.getAsFile() API\n    // NOTE: FileSystemEntry.file() throws if trying to get the file\n    if (entry && entry.isDirectory) {\n        return fromDirEntry(entry);\n    }\n    return fromDataTransferItem(item);\n}\nfunction flatten(items) {\n    return items.reduce(function (acc, files) { return __spreadArray(__spreadArray([], __read(acc), false), __read((Array.isArray(files) ? flatten(files) : [files])), false); }, []);\n}\nfunction fromDataTransferItem(item) {\n    var file = item.getAsFile();\n    if (!file) {\n        return Promise.reject(\"\".concat(item, \" is not a File\"));\n    }\n    var fwp = toFileWithPath(file);\n    return Promise.resolve(fwp);\n}\n// https://developer.mozilla.org/en-US/docs/Web/API/FileSystemEntry\nfunction fromEntry(entry) {\n    return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            return [2 /*return*/, entry.isDirectory ? fromDirEntry(entry) : fromFileEntry(entry)];\n        });\n    });\n}\n// https://developer.mozilla.org/en-US/docs/Web/API/FileSystemDirectoryEntry\nfunction fromDirEntry(entry) {\n    var reader = entry.createReader();\n    return new Promise(function (resolve, reject) {\n        var entries = [];\n        function readEntries() {\n            var _this = this;\n            // https://developer.mozilla.org/en-US/docs/Web/API/FileSystemDirectoryEntry/createReader\n            // https://developer.mozilla.org/en-US/docs/Web/API/FileSystemDirectoryReader/readEntries\n            reader.readEntries(function (batch) { return __awaiter(_this, void 0, void 0, function () {\n                var files, err_1, items;\n                return __generator(this, function (_a) {\n                    switch (_a.label) {\n                        case 0:\n                            if (!!batch.length) return [3 /*break*/, 5];\n                            _a.label = 1;\n                        case 1:\n                            _a.trys.push([1, 3, , 4]);\n                            return [4 /*yield*/, Promise.all(entries)];\n                        case 2:\n                            files = _a.sent();\n                            resolve(files);\n                            return [3 /*break*/, 4];\n                        case 3:\n                            err_1 = _a.sent();\n                            reject(err_1);\n                            return [3 /*break*/, 4];\n                        case 4: return [3 /*break*/, 6];\n                        case 5:\n                            items = Promise.all(batch.map(fromEntry));\n                            entries.push(items);\n                            // Continue reading\n                            readEntries();\n                            _a.label = 6;\n                        case 6: return [2 /*return*/];\n                    }\n                });\n            }); }, function (err) {\n                reject(err);\n            });\n        }\n        readEntries();\n    });\n}\n// https://developer.mozilla.org/en-US/docs/Web/API/FileSystemFileEntry\nfunction fromFileEntry(entry) {\n    return __awaiter(this, void 0, void 0, function () {\n        return __generator(this, function (_a) {\n            return [2 /*return*/, new Promise(function (resolve, reject) {\n                    entry.file(function (file) {\n                        var fwp = toFileWithPath(file, entry.fullPath);\n                        resolve(fwp);\n                    }, function (err) {\n                        reject(err);\n                    });\n                })];\n        });\n    });\n}\n//# sourceMappingURL=file-selector.js.map","\"use strict\";\n\nexports.__esModule = true;\n\nexports.default = function (file, acceptedFiles) {\n  if (file && acceptedFiles) {\n    var acceptedFilesArray = Array.isArray(acceptedFiles) ? acceptedFiles : acceptedFiles.split(',');\n    var fileName = file.name || '';\n    var mimeType = (file.type || '').toLowerCase();\n    var baseMimeType = mimeType.replace(/\\/.*$/, '');\n    return acceptedFilesArray.some(function (type) {\n      var validType = type.trim().toLowerCase();\n\n      if (validType.charAt(0) === '.') {\n        return fileName.toLowerCase().endsWith(validType);\n      } else if (validType.endsWith('/*')) {\n        // This is something like a image/* mime type\n        return baseMimeType === validType.replace(/\\/.*$/, '');\n      }\n\n      return mimeType === validType;\n    });\n  }\n\n  return true;\n};","import { ddsBaseTokens } from '@norges-domstoler/dds-design-tokens';\n\nconst { colors, spacing } = ddsBaseTokens;\n\nexport const rootTokens = {\n  borderColor: colors.DdsColorNeutralsGray5,\n  borderColorError: colors.DdsColorDangerBase,\n  paddingLeftRightTop: spacing.SizesDdsSpacingLocalX15,\n  paddingBottom: spacing.SizesDdsSpacingLocalX2,\n  gap: spacing.SizesDdsSpacingLocalX1,\n  backgroundColor: colors.DdsColorNeutralsWhite,\n  dragActive: {\n    borderColor: colors.DdsColorInteractiveBase,\n    backgroundColor: colors.DdsColorInteractiveLightest,\n  },\n};\n\nexport const fileTokens = {\n  marginTop: spacing.SizesDdsSpacingLocalX05,\n  paddingLeftRight: spacing.SizesDdsSpacingLocalX05,\n  paddingTopBottom: spacing.SizesDdsSpacingLayoutX1,\n  backgroundColor: colors.DdsColorNeutralsGray1,\n  textToIconsGap: spacing.SizesDdsSpacingLocalX075,\n  invalid: {\n    borderColor: colors.DdsColorDangerBase,\n  },\n};\n\nexport const errorsTokens = {\n  gap: spacing.SizesDdsSpacingLocalX025,\n};\n","import styled from 'styled-components';\nimport { InputMessage } from '../InputMessage';\nimport { errorsTokens } from './FileUploader.tokens';\n\ntype ErrorListProps = {\n  errors: {\n    id: string | undefined;\n    message: string;\n  }[];\n};\n\nexport const MessageContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: ${errorsTokens.gap};\n`;\n\nexport const ErrorList = (props: ErrorListProps) => {\n  const { errors } = props;\n\n  if (errors.length < 1) {\n    return null;\n  }\n\n  return (\n    <MessageContainer>\n      {errors.map(({ id, message }) => {\n        return (\n          <InputMessage\n            key={id}\n            id={id}\n            message={message}\n            messageType=\"error\"\n          />\n        );\n      })}\n    </MessageContainer>\n  );\n};\n","import styled from 'styled-components';\nimport { CloseIcon } from '@norges-domstoler/dds-icons';\nimport {\n  derivativeIdGenerator,\n  spaceSeparatedIdListGenerator,\n} from '@norges-domstoler/dds-core';\n\nimport { Button } from '../Button';\nimport { ErrorList } from './ErrorList';\nimport { fileTokens } from './FileUploader.tokens';\nimport { FileUploaderFile } from './fileUploaderReducer';\n\ntype FileProps = {\n  parentId: string;\n  index: number;\n  isValid: boolean;\n  file: FileUploaderFile;\n  removeFile: () => void;\n};\n\nconst FileWrapper = styled.li``;\n\nconst FileNameWrapper = styled.span`\n  word-break: break-all;\n`;\n\nconst FileElement = styled.div<FileProps>`\n  border-width: 2px;\n  border-style: solid;\n  border-color: ${({ isValid }) =>\n    isValid ? fileTokens.backgroundColor : fileTokens.invalid.borderColor};\n  margin-top: ${fileTokens.marginTop};\n  padding: ${fileTokens.paddingLeftRight} ${fileTokens.paddingTopBottom};\n  background-color: ${fileTokens.backgroundColor};\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  gap: ${fileTokens.textToIconsGap};\n`;\n\nconst RemoveFileButton = styled(Button)`\n  padding: 0;\n`;\n\nexport const File = (props: FileProps) => {\n  const { parentId, index, file: stateFile, removeFile, isValid } = props;\n\n  const errorsList = stateFile.errors.map((e, errorIndex) => ({\n    id: derivativeIdGenerator(parentId, `file-${index}-error-${errorIndex}`),\n    message: e,\n  }));\n\n  return (\n    <FileWrapper key={stateFile.file.name}>\n      <FileElement {...props}>\n        <FileNameWrapper>{stateFile.file.name}</FileNameWrapper>\n        <RemoveFileButton\n          size=\"small\"\n          appearance=\"borderless\"\n          purpose=\"secondary\"\n          type=\"button\"\n          onClick={removeFile}\n          icon={CloseIcon}\n          htmlProps={{\n            'aria-label': `Fjern fil, ${stateFile.file.name}`,\n            'aria-invalid': !isValid ? true : undefined,\n            'aria-errormessage': !isValid ? 'Ugyldig fil' : undefined,\n            'aria-describedby': spaceSeparatedIdListGenerator(\n              errorsList.map(e => e.id)\n            ),\n          }}\n        />\n      </FileElement>\n      <ErrorList errors={errorsList} />\n    </FileWrapper>\n  );\n};\n","import { FileWithPath } from 'file-selector';\nimport { Reducer } from 'react';\n\nexport type FileUploaderFile = {\n  file: FileWithPath;\n  errors: string[];\n};\n\nexport type RootErrorList = string[];\n\nexport type FileUploaderAction =\n  | { type: 'focus' }\n  | { type: 'blur' }\n  | { type: 'dragEnter' }\n  | { type: 'dragLeave' }\n  | {\n      type: 'onSetFiles';\n      payload: FileUploaderFile[];\n    }\n  | {\n      type: 'onRemoveFile';\n      payload: FileUploaderFile[];\n    }\n  | {\n      type: 'setRootErrors';\n      payload: RootErrorList;\n    };\n\nexport type FileUploaderState = {\n  files: FileUploaderFile[];\n  isFocused: boolean;\n  isFileDialogActive: boolean;\n  isDragActive: boolean;\n  rootErrors: string[];\n};\n\nexport const fileUploaderReducer: Reducer<\n  FileUploaderState,\n  FileUploaderAction\n> = (state, action) => {\n  switch (action.type) {\n    case 'focus':\n      return { ...state, isFocused: true };\n    case 'blur':\n      return { ...state, isFocused: false };\n    case 'dragEnter':\n      return {\n        ...state,\n        isDragActive: true,\n      };\n    case 'dragLeave':\n      return { ...state, isDragActive: false };\n    case 'onSetFiles':\n      return {\n        ...state,\n        isDragActive: false,\n        files: action.payload,\n      };\n    case 'onRemoveFile':\n      return {\n        ...state,\n        files: action.payload,\n      };\n    case 'setRootErrors':\n      return {\n        ...state,\n        rootErrors: action.payload,\n      };\n    default:\n      return state;\n  }\n};\n","import accepted from 'attr-accept';\n\nexport const preventDefaults = (event: React.BaseSyntheticEvent) => {\n  event.preventDefault();\n  event.stopPropagation();\n};\n\nexport const isDragEvent = (\n  event: unknown\n): event is React.DragEvent<unknown> => {\n  const asDragEvent = event as React.DragEvent<unknown>;\n\n  return asDragEvent.dataTransfer !== undefined;\n};\n\nexport const isEventWithFiles = (\n  event: React.DragEvent<unknown> | React.ChangeEvent<HTMLInputElement>\n): boolean => {\n  if (!isDragEvent(event)) {\n    return event.target.files !== null && event.target.files !== undefined;\n  }\n\n  return (\n    event.dataTransfer.types.includes('Files') ||\n    event.dataTransfer.types.includes('application/x-moz-file')\n  );\n};\n\nexport const isFileAccepted = (\n  file: File,\n  accept: string[] | undefined\n): boolean => {\n  return accept !== undefined ? accepted(file, accept) : true;\n};\n\n// export const isFileSizeAccepted = (\n//   file: File,\n//   minSize: number | undefined,\n//   maxSize: number | undefined\n// ): boolean => {};\n\nexport const getTooManyFilesErrorMessage = (maxFiles: number) =>\n  `For mange filer, maks ${maxFiles}stk`;\n\nexport const getInvalidFileTypeErrorMessage = () => 'Ugyldig filtype';\n","import React, {\n  ButtonHTMLAttributes,\n  HTMLAttributes,\n  InputHTMLAttributes,\n  Ref,\n  useCallback,\n  useEffect,\n  useMemo,\n  useReducer,\n  useRef,\n} from 'react';\nimport {\n  FileUploaderFile,\n  fileUploaderReducer,\n  RootErrorList,\n} from './fileUploaderReducer';\nimport { FileWithPath, fromEvent as getFilesFromEvent } from 'file-selector';\nimport { Accept, FileList } from './types';\nimport {\n  getInvalidFileTypeErrorMessage,\n  getTooManyFilesErrorMessage,\n  isEventWithFiles,\n  isFileAccepted,\n  preventDefaults,\n} from './utils';\n\nexport type FileUploaderHookProps = {\n  id: string | undefined;\n  /**Dersom komponenten skal styres internt. Utgangspunktet for filene som har blitt lastet opp. */\n  initialFiles: FileList | undefined;\n  /**Dersom komponenten styres utenfra. Filene som har blitt lastet opp. */\n  value: FileList | undefined;\n  /**Callback for når fil-listen endres. */\n  onChange: (newFiles: FileList) => void;\n  /**Hvilke filendelser eller mime-typer som filopplasteren skal akseptere. */\n  accept: Accept[] | undefined;\n  /**Om filopplasteren er avslått eller ikke */\n  disabled: boolean | undefined;\n  /**Maks antall filer som tillates. */\n  maxFiles: number | undefined;\n  /**Feilmelding. Setter også error state. */\n  errorMessage: string | undefined;\n};\n\nconst calcRootErrors = (\n  files: FileUploaderFile[],\n  maxFiles: number | undefined,\n  errorMessage: string | undefined\n): RootErrorList => {\n  const errors: RootErrorList = [];\n\n  if (maxFiles && maxFiles >= 1 && files.length > maxFiles) {\n    errors.push(getTooManyFilesErrorMessage(maxFiles));\n  }\n\n  if (errorMessage) {\n    errors.push(errorMessage);\n  }\n\n  return errors;\n};\n\nexport const useFileUploader = <TRootElement extends HTMLElement>(\n  props: FileUploaderHookProps\n) => {\n  const {\n    initialFiles,\n    value,\n    onChange,\n    accept,\n    maxFiles,\n    disabled,\n    errorMessage,\n  } = props;\n\n  const rootRef = useRef<TRootElement>(null);\n  const inputRef = useRef<HTMLInputElement>(null);\n  const buttonRef = useRef<HTMLButtonElement>(null);\n  const isControlled = !!value;\n\n  const initialFileUploaderFiles = useMemo(\n    () =>\n      (initialFiles ?? []).map<FileUploaderFile>(f => ({\n        file: f,\n        errors: [],\n      })),\n    [initialFiles]\n  );\n\n  const [state, dispatch] = useReducer(fileUploaderReducer, {\n    files: initialFileUploaderFiles,\n    isFocused: false,\n    isFileDialogActive: false,\n    isDragActive: false,\n    rootErrors: calcRootErrors(\n      initialFileUploaderFiles,\n      maxFiles,\n      errorMessage\n    ),\n  });\n\n  const { files: stateFiles } = state;\n\n  useEffect(() => {\n    if (isControlled) {\n      const files = value.map<FileUploaderFile>(file => {\n        const accepted = isFileAccepted(file, accept);\n\n        return {\n          file,\n          errors: accepted ? [] : [getInvalidFileTypeErrorMessage()],\n        };\n      });\n\n      dispatch({\n        type: 'onSetFiles',\n        payload: files,\n      });\n    }\n  }, [value, isControlled, accept, dispatch]);\n\n  useEffect(() => {\n    dispatch({\n      type: 'setRootErrors',\n      payload: calcRootErrors(stateFiles, maxFiles, errorMessage),\n    });\n  }, [dispatch, stateFiles, maxFiles, errorMessage]);\n\n  const onRootFocus = useCallback(\n    () => dispatch({ type: 'focus' }),\n    [dispatch]\n  );\n\n  const onRootBlur = useCallback(() => dispatch({ type: 'blur' }), [dispatch]);\n\n  const onRootDragEnter = useCallback(\n    async (evt: React.DragEvent<TRootElement>) => {\n      preventDefaults(evt);\n\n      if (isEventWithFiles(evt)) {\n        const files = await getFilesFromEvent(evt);\n        const fileCount = files.length;\n\n        if (fileCount === 0) return;\n\n        dispatch({ type: 'dragEnter' });\n      }\n    },\n    [dispatch, accept, maxFiles]\n  );\n\n  const onRootDragOver = useCallback((evt: React.DragEvent<TRootElement>) => {\n    preventDefaults(evt);\n\n    const hasFiles = isEventWithFiles(evt);\n    if (hasFiles && evt.dataTransfer) {\n      try {\n        evt.dataTransfer.dropEffect = 'copy';\n      } catch {} /* eslint-disable-line no-empty */\n    }\n  }, []);\n\n  const onRootDragLeave = useCallback(\n    (evt: React.DragEvent<TRootElement>) => {\n      preventDefaults(evt);\n\n      if (evt.currentTarget.contains(evt.relatedTarget as HTMLElement)) return;\n\n      dispatch({ type: 'dragLeave' });\n    },\n    [dispatch]\n  );\n\n  const setFiles = useCallback(\n    async (\n      evt: React.DragEvent<TRootElement> | React.ChangeEvent<HTMLInputElement>\n    ) => {\n      evt.preventDefault();\n      if (isEventWithFiles(evt)) {\n        const existingFileNames = stateFiles.map(f => f.file.name);\n\n        // TODO: Fiks cast her.\n        const filesFromEvent = (await getFilesFromEvent(evt)) as FileWithPath[];\n\n        const newFiles = filesFromEvent\n          .filter(f => !existingFileNames.includes(f.name))\n          .map<FileUploaderFile>(file => {\n            const accepted = isFileAccepted(file, accept);\n\n            return {\n              file,\n              errors: accepted ? [] : [getInvalidFileTypeErrorMessage()],\n            };\n          })\n          .concat(stateFiles);\n\n        onChange(newFiles.map(f => f.file));\n\n        if (!isControlled) {\n          dispatch({\n            type: 'onSetFiles',\n            payload: newFiles,\n          });\n        }\n      }\n    },\n    [\n      stateFiles,\n      isControlled,\n      accept,\n      errorMessage,\n      maxFiles,\n      onChange,\n      dispatch,\n    ]\n  );\n\n  const openFileDialog = useCallback(() => {\n    if (inputRef.current) {\n      inputRef.current.value = '';\n      inputRef.current.click();\n    }\n  }, [inputRef]);\n\n  const removeFile = useCallback(\n    (file: FileUploaderFile) => {\n      const newFiles = [...stateFiles];\n      newFiles.splice(stateFiles.indexOf(file), 1);\n\n      onChange(newFiles.map(f => f.file));\n\n      if (!isControlled) {\n        dispatch({\n          type: 'onRemoveFile',\n          payload: newFiles,\n        });\n      }\n    },\n    [stateFiles, isControlled, maxFiles, errorMessage, onChange, dispatch]\n  );\n\n  const getRootProps = useCallback(\n    (): HTMLAttributes<TRootElement> & {\n      ref: Ref<TRootElement>;\n    } => ({\n      onBlur: onRootBlur,\n      onFocus: onRootFocus,\n      onDragEnter: onRootDragEnter,\n      onDragOver: onRootDragOver,\n      onDragLeave: onRootDragLeave,\n      onDrop: setFiles,\n      ref: rootRef,\n    }),\n    [\n      onRootBlur,\n      onRootFocus,\n      onRootDragEnter,\n      onRootDragOver,\n      setFiles,\n      rootRef,\n      disabled,\n    ]\n  );\n\n  const getButtonProps = useCallback(\n    (): ButtonHTMLAttributes<HTMLButtonElement> & {\n      ref: Ref<HTMLButtonElement>;\n    } => ({\n      onClick: openFileDialog,\n      ref: buttonRef,\n    }),\n    [openFileDialog, buttonRef]\n  );\n\n  const getInputProps = useCallback(\n    (): InputHTMLAttributes<HTMLInputElement> & {\n      ref: Ref<HTMLInputElement>;\n    } => ({\n      type: 'file',\n      style: { display: 'none' },\n      tabIndex: -1,\n      ref: inputRef,\n      onChange: setFiles,\n      multiple: !maxFiles || maxFiles > 1,\n      ...(accept ? { accept: accept.join(',') } : {}),\n    }),\n    [inputRef, setFiles, maxFiles, accept]\n  );\n\n  return {\n    state,\n    getRootProps,\n    getInputProps,\n    getButtonProps,\n    removeFile,\n  };\n};\n","import { useId } from 'react';\nimport styled from 'styled-components';\nimport { UploadIcon } from '@norges-domstoler/dds-icons';\nimport {\n  derivativeIdGenerator,\n  spaceSeparatedIdListGenerator,\n} from '@norges-domstoler/dds-core';\nimport { Label } from '@norges-domstoler/dds-typography';\nimport { Button } from '../Button';\nimport { InputMessage } from '../InputMessage';\nimport { VisuallyHidden } from '../VisuallyHidden';\nimport { ErrorList } from './ErrorList';\nimport { File } from './File';\nimport { rootTokens } from './FileUploader.tokens';\nimport { FileList } from './types';\nimport { FileUploaderHookProps, useFileUploader } from './useFileUploader';\nimport { Property } from 'csstype';\n\nconst defaultWidth: Property.Width<string> = '320px';\n\nconst Wrapper = styled.div<{ width?: Property.Width<string> }>`\n  width: ${({ width }) => (width ? width : defaultWidth)};\n`;\n\ntype RootProps = {\n  isDragActive: boolean;\n  hasRootErrors: boolean;\n};\n\nconst Root = styled.div<RootProps>`\n  box-sizing: border-box;\n  border-width: ${({ hasRootErrors }) => (hasRootErrors ? '2px' : '1px')};\n  border-style: dashed;\n  border-color: ${({ isDragActive, hasRootErrors }) =>\n    isDragActive\n      ? rootTokens.dragActive.borderColor\n      : hasRootErrors\n      ? rootTokens.borderColorError\n      : rootTokens.borderColor};\n  padding: ${({ hasRootErrors }) =>\n    hasRootErrors\n      ? `calc(${rootTokens.paddingLeftRightTop} - 1px) calc(${rootTokens.paddingLeftRightTop} - 1px) ${rootTokens.paddingBottom}`\n      : `${rootTokens.paddingLeftRightTop} ${rootTokens.paddingLeftRightTop} ${rootTokens.paddingBottom}`};\n  display: flex;\n  flex-direction: column;\n  gap: ${rootTokens.gap};\n  background-color: ${({ isDragActive }) =>\n    isDragActive\n      ? rootTokens.dragActive.backgroundColor\n      : rootTokens.backgroundColor};\n`;\n\nconst FileUploaderInput = styled.input``;\n\nconst FileListElement = styled.ul`\n  margin: 0;\n  padding: 0;\n  list-style-type: none;\n`;\n\ntype FileUploaderProps = {\n  /**Id til filopplasteren. */\n  id?: string;\n  /**Ledetekst for filopplaster. */\n  label?: string;\n  /**Hjelpetekst. */\n  tip?: string;\n  /**Om det er påkrevd med minst en fil. */\n  required?: boolean;\n  /**Callback for når fil-listen endres. */\n  onChange: (newFiles: FileList) => void;\n  /**Bredde for filopplasteren. */\n  width?: Property.Width<string>;\n} & Partial<FileUploaderHookProps>;\n\nexport const FileUploader = (props: FileUploaderProps) => {\n  const {\n    id,\n    label,\n    tip,\n    required = false,\n    initialFiles,\n    value,\n    accept,\n    maxFiles,\n    disabled,\n    onChange,\n    width,\n    errorMessage,\n  } = props;\n\n  const generatedId = useId();\n  const uniqueId = id ?? `${generatedId}-fileUploader`;\n\n  const {\n    state: { files: stateFiles, isDragActive, rootErrors },\n    getRootProps,\n    getInputProps,\n    getButtonProps,\n    removeFile,\n  } = useFileUploader<HTMLDivElement>({\n    id,\n    initialFiles,\n    value,\n    onChange,\n    accept,\n    disabled,\n    maxFiles,\n    errorMessage,\n  });\n  const hasLabel = label !== undefined;\n  const hasTip = tip !== undefined;\n  const hasRootErrors = rootErrors.length > 0;\n  const showRequiredMarker = required;\n\n  const tipId = derivativeIdGenerator(uniqueId, 'tip');\n\n  const fileListElements = stateFiles.map((stateFile, index) => (\n    <File\n      key={stateFile.file.name}\n      parentId={uniqueId}\n      index={index}\n      file={stateFile}\n      isValid={stateFile.errors.length === 0}\n      removeFile={() => removeFile(stateFile)}\n    />\n  ));\n\n  const rootErrorsList = rootErrors.map((e, index) => ({\n    id: derivativeIdGenerator(uniqueId, `error-${index}`),\n    message: e,\n  }));\n\n  return (\n    <Wrapper width={width}>\n      {hasLabel && (\n        <Label showRequiredStyling={showRequiredMarker} htmlFor={uniqueId}>\n          {label}\n        </Label>\n      )}\n      {hasTip && <InputMessage id={tipId} message={tip} messageType=\"tip\" />}\n      <Root\n        {...getRootProps()}\n        isDragActive={isDragActive}\n        hasRootErrors={hasRootErrors}\n      >\n        <FileUploaderInput {...getInputProps()} />\n        Dra og slipp filer her eller{' '}\n        <VisuallyHidden as=\"span\">velg fil med påfølgende knapp</VisuallyHidden>\n        <Button\n          {...getButtonProps()}\n          id={uniqueId}\n          size=\"medium\"\n          type=\"button\"\n          appearance=\"filled\"\n          purpose=\"secondary\"\n          label=\"Velg fil\"\n          icon={UploadIcon}\n          htmlProps={{\n            'aria-invalid': hasRootErrors ? true : undefined,\n            'aria-describedby': spaceSeparatedIdListGenerator([\n              hasTip ? tipId : undefined,\n              ...rootErrorsList.map(e => e.id),\n            ]),\n          }}\n        />\n      </Root>\n      <ErrorList errors={rootErrorsList} />\n\n      <FileListElement>{fileListElements}</FileListElement>\n    </Wrapper>\n  );\n};\n\nFileUploader.displayName = 'FileUploader';\n"],"names":["COMMON_MIME_TYPES","toFileWithPath","file","path","f","withMimeType","webkitRelativePath","name","hasExtension","ext","type","FILES_TO_IGNORE","fromEvent","evt","__awaiter","__generator","_a","isObject","isDataTransfer","getDataTransferFiles","isChangeEvt","getInputFiles","item","getFsHandleFiles","value","v","fromList","handles","files","h","dt","items","toFilePromises","noIgnoredFiles","flatten","i","fromDataTransferItem","entry","fromDirEntry","acc","__spreadArray","__read","fwp","fromEntry","fromFileEntry","reader","resolve","reject","entries","readEntries","_this","batch","err_1","err","_default","acceptedFiles","acceptedFilesArray","fileName","mimeType","baseMimeType","validType","colors","spacing","ddsBaseTokens","rootTokens","fileTokens","errorsTokens","MessageContainer","styled","ErrorList","props","errors","jsx","id","message","InputMessage","FileWrapper","FileNameWrapper","FileElement","isValid","RemoveFileButton","Button","File","parentId","index","stateFile","removeFile","errorsList","e","errorIndex","derivativeIdGenerator","jsxs","CloseIcon","spaceSeparatedIdListGenerator","fileUploaderReducer","state","action","preventDefaults","event","isDragEvent","isEventWithFiles","isFileAccepted","accept","accepted","getTooManyFilesErrorMessage","maxFiles","getInvalidFileTypeErrorMessage","calcRootErrors","errorMessage","useFileUploader","initialFiles","onChange","disabled","rootRef","useRef","inputRef","buttonRef","isControlled","initialFileUploaderFiles","useMemo","dispatch","useReducer","stateFiles","useEffect","onRootFocus","useCallback","onRootBlur","onRootDragEnter","getFilesFromEvent","onRootDragOver","onRootDragLeave","setFiles","existingFileNames","newFiles","openFileDialog","getRootProps","getButtonProps","getInputProps","defaultWidth","Wrapper","width","Root","hasRootErrors","isDragActive","FileUploaderInput","FileListElement","FileUploader","label","tip","required","generatedId","useId","uniqueId","rootErrors","hasLabel","hasTip","showRequiredMarker","tipId","fileListElements","rootErrorsList","Label","VisuallyHidden","UploadIcon"],"mappings":"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","x_google_ignoreList":[0,1,2]}