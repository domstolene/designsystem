import{d as me,s as y,j as p,a as z}from"./focus-visible-c2e9b88d.js";import{r as s}from"./index-ebeaab24.js";import{R as ge}from"./storybook-components-c9cbefc3.js";import{I as se}from"./InputMessage-bb06ca10.js";import{B as le}from"./Button-2e74127f.js";import{d as H,s as ce}from"./idGenerator-c29473b2.js";import{C as ve}from"./close-10bf9508.js";import{a as T,b as L,c as Y,d as J}from"./tslib.es6-b1ce3a18.js";import{V as he}from"./VisuallyHidden-9c195a2c.js";import{U as be}from"./upload-1bd5490a.js";import{L as ye}from"./Label-ec3ecd5b.js";var xe=new Map([["aac","audio/aac"],["abw","application/x-abiword"],["arc","application/x-freearc"],["avif","image/avif"],["avi","video/x-msvideo"],["azw","application/vnd.amazon.ebook"],["bin","application/octet-stream"],["bmp","image/bmp"],["bz","application/x-bzip"],["bz2","application/x-bzip2"],["cda","application/x-cdf"],["csh","application/x-csh"],["css","text/css"],["csv","text/csv"],["doc","application/msword"],["docx","application/vnd.openxmlformats-officedocument.wordprocessingml.document"],["eot","application/vnd.ms-fontobject"],["epub","application/epub+zip"],["gz","application/gzip"],["gif","image/gif"],["heic","image/heic"],["heif","image/heif"],["htm","text/html"],["html","text/html"],["ico","image/vnd.microsoft.icon"],["ics","text/calendar"],["jar","application/java-archive"],["jpeg","image/jpeg"],["jpg","image/jpeg"],["js","text/javascript"],["json","application/json"],["jsonld","application/ld+json"],["mid","audio/midi"],["midi","audio/midi"],["mjs","text/javascript"],["mp3","audio/mpeg"],["mp4","video/mp4"],["mpeg","video/mpeg"],["mpkg","application/vnd.apple.installer+xml"],["odp","application/vnd.oasis.opendocument.presentation"],["ods","application/vnd.oasis.opendocument.spreadsheet"],["odt","application/vnd.oasis.opendocument.text"],["oga","audio/ogg"],["ogv","video/ogg"],["ogx","application/ogg"],["opus","audio/opus"],["otf","font/otf"],["png","image/png"],["pdf","application/pdf"],["php","application/x-httpd-php"],["ppt","application/vnd.ms-powerpoint"],["pptx","application/vnd.openxmlformats-officedocument.presentationml.presentation"],["rar","application/vnd.rar"],["rtf","application/rtf"],["sh","application/x-sh"],["svg","image/svg+xml"],["swf","application/x-shockwave-flash"],["tar","application/x-tar"],["tif","image/tiff"],["tiff","image/tiff"],["ts","video/mp2t"],["ttf","font/ttf"],["txt","text/plain"],["vsd","application/vnd.visio"],["wav","audio/wav"],["weba","audio/webm"],["webm","video/webm"],["webp","image/webp"],["woff","font/woff"],["woff2","font/woff2"],["xhtml","application/xhtml+xml"],["xls","application/vnd.ms-excel"],["xlsx","application/vnd.openxmlformats-officedocument.spreadsheetml.sheet"],["xml","application/xml"],["xul","application/vnd.mozilla.xul+xml"],["zip","application/zip"],["7z","application/x-7z-compressed"],["mkv","video/x-matroska"],["mov","video/quicktime"],["msg","application/vnd.ms-outlook"]]);function I(e,r){var t=Fe(e);if(typeof t.path!="string"){var o=e.webkitRelativePath;Object.defineProperty(t,"path",{value:typeof r=="string"?r:typeof o=="string"&&o.length>0?o:e.name,writable:!1,configurable:!1,enumerable:!0})}return t}function Fe(e){var r=e.name,t=r&&r.lastIndexOf(".")!==-1;if(t&&!e.type){var o=r.split(".").pop().toLowerCase(),i=xe.get(o);i&&Object.defineProperty(e,"type",{value:i,writable:!1,configurable:!1,enumerable:!0})}return e}var we=[".DS_Store","Thumbs.db"];function Q(e){return T(this,void 0,void 0,function(){return L(this,function(r){return G(e)&&Ce(e.dataTransfer)?[2,Te(e.dataTransfer,e.type)]:Ee(e)?[2,ke(e)]:Array.isArray(e)&&e.every(function(t){return"getFile"in t&&typeof t.getFile=="function"})?[2,De(e)]:[2,[]]})})}function Ce(e){return G(e)}function Ee(e){return G(e)&&G(e.target)}function G(e){return typeof e=="object"&&e!==null}function ke(e){return K(e.target.files).map(function(r){return I(r)})}function De(e){return T(this,void 0,void 0,function(){var r;return L(this,function(t){switch(t.label){case 0:return[4,Promise.all(e.map(function(o){return o.getFile()}))];case 1:return r=t.sent(),[2,r.map(function(o){return I(o)})]}})})}function Te(e,r){return T(this,void 0,void 0,function(){var t,o;return L(this,function(i){switch(i.label){case 0:return e.items?(t=K(e.items).filter(function(a){return a.kind==="file"}),r!=="drop"?[2,t]:[4,Promise.all(t.map(Le))]):[3,2];case 1:return o=i.sent(),[2,Z(pe(o))];case 2:return[2,Z(K(e.files).map(function(a){return I(a)}))]}})})}function Z(e){return e.filter(function(r){return we.indexOf(r.name)===-1})}function K(e){if(e===null)return[];for(var r=[],t=0;t<e.length;t++){var o=e[t];r.push(o)}return r}function Le(e){if(typeof e.webkitGetAsEntry!="function")return ee(e);var r=e.webkitGetAsEntry();return r&&r.isDirectory?de(r):ee(e)}function pe(e){return e.reduce(function(r,t){return Y(Y([],J(r),!1),J(Array.isArray(t)?pe(t):[t]),!1)},[])}function ee(e){var r=e.getAsFile();if(!r)return Promise.reject("".concat(e," is not a File"));var t=I(r);return Promise.resolve(t)}function Se(e){return T(this,void 0,void 0,function(){return L(this,function(r){return[2,e.isDirectory?de(e):Re(e)]})})}function de(e){var r=e.createReader();return new Promise(function(t,o){var i=[];function a(){var v=this;r.readEntries(function(l){return T(v,void 0,void 0,function(){var b,g,w;return L(this,function(d){switch(d.label){case 0:if(l.length)return[3,5];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,Promise.all(i)];case 2:return b=d.sent(),t(b),[3,4];case 3:return g=d.sent(),o(g),[3,4];case 4:return[3,6];case 5:w=Promise.all(l.map(Se)),i.push(w),a(),d.label=6;case 6:return[2]}})})},function(l){o(l)})}a()})}function Re(e){return T(this,void 0,void 0,function(){return L(this,function(r){return[2,new Promise(function(t,o){e.file(function(i){var a=I(i,e.fullPath);t(a)},function(i){o(i)})})]})})}var ze=function(e,r){if(e&&r){var t=Array.isArray(r)?r:r.split(","),o=e.name||"",i=(e.type||"").toLowerCase(),a=i.replace(/\/.*$/,"");return t.some(function(v){var l=v.trim().toLowerCase();return l.charAt(0)==="."?o.toLowerCase().endsWith(l):l.endsWith("/*")?a===l.replace(/\/.*$/,""):i===l})}return!0};const{colors:E,spacing:F}=me,m={borderColor:E.DdsColorNeutralsGray5,borderColorError:E.DdsColorDangerBase,paddingLeftRightTop:F.SizesDdsSpacingLocalX15,paddingBottom:F.SizesDdsSpacingLocalX2,gap:F.SizesDdsSpacingLocalX1,backgroundColor:E.DdsColorNeutralsWhite,dragActive:{borderColor:E.DdsColorInteractiveBase,backgroundColor:E.DdsColorInteractiveLightest}},C={marginTop:F.SizesDdsSpacingLocalX05,paddingLeftRight:F.SizesDdsSpacingLocalX05,paddingTopBottom:F.SizesDdsSpacingLayoutX1,backgroundColor:E.DdsColorNeutralsGray1,textToIconsGap:F.SizesDdsSpacingLocalX075,invalid:{borderColor:E.DdsColorDangerBase}},Ie={gap:F.SizesDdsSpacingLocalX025},je=y.div`
  display: flex;
  flex-direction: column;
  gap: ${Ie.gap};
`,ue=e=>{const{errors:r}=e;return r.length<1?null:p(je,{children:r.map(({id:t,message:o})=>p(se,{id:t,message:o,messageType:"error"},t))})},$e=y.li``,Pe=y.span`
  word-break: break-all;
`,Me=y.div`
  border-width: 2px;
  border-style: solid;
  border-color: ${({isValid:e})=>e?C.backgroundColor:C.invalid.borderColor};
  margin-top: ${C.marginTop};
  padding: ${C.paddingLeftRight} ${C.paddingTopBottom};
  background-color: ${C.backgroundColor};
  display: flex;
  justify-content: space-between;
  align-items: center;
  gap: ${C.textToIconsGap};
`,Ae=y(le)`
  padding: 0;
`,Ue=e=>{const{parentId:r,index:t,file:o,removeFile:i,isValid:a}=e,v=o.errors.map((l,b)=>({id:H(r,`file-${t}-error-${b}`),message:l}));return z($e,{children:[z(Me,{...e,children:[p(Pe,{children:o.file.name}),p(Ae,{size:"small",appearance:"borderless",purpose:"secondary",type:"button",onClick:i,icon:ve,htmlProps:{"aria-label":`Fjern fil, ${o.file.name}`,"aria-invalid":a?void 0:!0,"aria-errormessage":a?void 0:"Ugyldig fil","aria-describedby":ce(v.map(l=>l.id))}})]}),p(ue,{errors:v})]},o.file.name)},_e=(e,r)=>{switch(r.type){case"focus":return{...e,isFocused:!0};case"blur":return{...e,isFocused:!1};case"dragEnter":return{...e,isDragActive:!0};case"dragLeave":return{...e,isDragActive:!1};case"onSetFiles":return{...e,isDragActive:!1,files:r.payload};case"onRemoveFile":return{...e,files:r.payload};case"setRootErrors":return{...e,rootErrors:r.payload};default:return e}},X=e=>{e.preventDefault(),e.stopPropagation()},Oe=e=>e.dataTransfer!==void 0,V=e=>Oe(e)?e.dataTransfer.types.includes("Files")||e.dataTransfer.types.includes("application/x-moz-file"):e.target.files!==null&&e.target.files!==void 0,re=(e,r)=>r!==void 0?ze(e,r):!0,Be=e=>`For mange filer, maks ${e}stk`,te=()=>"Ugyldig filtype",oe=(e,r,t)=>{const o=[];return r&&r>=1&&e.length>r&&o.push(Be(r)),t&&o.push(t),o},We=e=>{const{initialFiles:r,value:t,onChange:o,accept:i,maxFiles:a,disabled:v,errorMessage:l}=e,b=s.useRef(null),g=s.useRef(null),w=s.useRef(null),d=!!t,$=s.useMemo(()=>(r??[]).map(n=>({file:n,errors:[]})),[r]),[P,c]=s.useReducer(_e,{files:$,isFocused:!1,isFileDialogActive:!1,isDragActive:!1,rootErrors:oe($,a,l)}),{files:h}=P;s.useEffect(()=>{if(d){const n=t.map(f=>{const u=re(f,i);return{file:f,errors:u?[]:[te()]}});c({type:"onSetFiles",payload:n})}},[t,d,i,c]),s.useEffect(()=>{c({type:"setRootErrors",payload:oe(h,a,l)})},[c,h,a,l]);const M=s.useCallback(()=>c({type:"focus"}),[c]),S=s.useCallback(()=>c({type:"blur"}),[c]),A=s.useCallback(async n=>{if(X(n),V(n)){if((await Q(n)).length===0)return;c({type:"dragEnter"})}},[c,i,a]),U=s.useCallback(n=>{if(X(n),V(n)&&n.dataTransfer)try{n.dataTransfer.dropEffect="copy"}catch{}},[]),q=s.useCallback(n=>{X(n),!n.currentTarget.contains(n.relatedTarget)&&c({type:"dragLeave"})},[c]),k=s.useCallback(async n=>{if(n.preventDefault(),V(n)){const f=h.map(x=>x.file.name),D=(await Q(n)).filter(x=>!f.includes(x.name)).map(x=>{const fe=re(x,i);return{file:x,errors:fe?[]:[te()]}}).concat(h);o(D.map(x=>x.file)),d||c({type:"onSetFiles",payload:D})}},[h,d,i,l,a,o,c]),_=s.useCallback(()=>{g.current&&(g.current.value="",g.current.click())},[g]),O=s.useCallback(n=>{const f=[...h];f.splice(h.indexOf(n),1),o(f.map(u=>u.file)),d||c({type:"onRemoveFile",payload:f})},[h,d,a,l,o,c]),B=s.useCallback(()=>({onBlur:S,onFocus:M,onDragEnter:A,onDragOver:U,onDragLeave:q,onDrop:k,ref:b}),[S,M,A,U,k,b,v]),N=s.useCallback(()=>({onClick:_,ref:w}),[_,w]),W=s.useCallback(()=>({type:"file",style:{display:"none"},tabIndex:-1,ref:g,onChange:k,multiple:!a||a>1,...i?{accept:i.join(",")}:{}}),[g,k,a,i]);return{state:P,getRootProps:B,getInputProps:W,getButtonProps:N,removeFile:O}},Ge="320px",qe=y.div`
  width: ${({width:e})=>e||Ge};
`,Ne=y.div`
  box-sizing: border-box;
  border-width: ${({hasRootErrors:e})=>e?"2px":"1px"};
  border-style: dashed;
  border-color: ${({isDragActive:e,hasRootErrors:r})=>e?m.dragActive.borderColor:r?m.borderColorError:m.borderColor};
  padding: ${({hasRootErrors:e})=>e?`calc(${m.paddingLeftRightTop} - 1px) calc(${m.paddingLeftRightTop} - 1px) ${m.paddingBottom}`:`${m.paddingLeftRightTop} ${m.paddingLeftRightTop} ${m.paddingBottom}`};
  display: flex;
  flex-direction: column;
  gap: ${m.gap};
  background-color: ${({isDragActive:e})=>e?m.dragActive.backgroundColor:m.backgroundColor};
`,Xe=y.input``,Ve=y.ul`
  margin: 0;
  padding: 0;
  list-style-type: none;
`,j=e=>{const{id:r,label:t,tip:o,required:i=!1,initialFiles:a,value:v,accept:l,maxFiles:b,disabled:g,onChange:w,width:d,errorMessage:$}=e,P=s.useId(),c=r??`${P}-fileUploader`,{state:{files:h,isDragActive:M,rootErrors:S},getRootProps:A,getInputProps:U,getButtonProps:q,removeFile:k}=We({id:r,initialFiles:a,value:v,onChange:w,accept:l,disabled:g,maxFiles:b,errorMessage:$}),_=t!==void 0,O=o!==void 0,B=S.length>0,N=i,W=H(c,"tip"),n=h.map((u,D)=>p(Ue,{parentId:c,index:D,file:u,isValid:u.errors.length===0,removeFile:()=>k(u)},u.file.name)),f=S.map((u,D)=>({id:H(c,`error-${D}`),message:u}));return z(qe,{width:d,children:[_&&p(ye,{showRequiredStyling:N,htmlFor:c,children:t}),O&&p(se,{id:W,message:o,messageType:"tip"}),z(Ne,{...A(),isDragActive:M,hasRootErrors:B,children:[p(Xe,{...U()}),"Dra og slipp filer her eller"," ",p(he,{as:"span",children:"velg fil med påfølgende knapp"}),p(le,{...q(),id:c,size:"medium",type:"button",appearance:"filled",purpose:"secondary",label:"Velg fil",icon:be,htmlProps:{"aria-invalid":B?!0:void 0,"aria-describedby":ce([O?W:void 0,...f.map(u=>u.id)])}})]}),p(ue,{errors:f}),p(Ve,{children:n})]})};j.displayName="FileUploader";const He={title:"dds-components/FileUploader BETA",component:j,argTypes:{color:{control:{type:"text"}},size:{control:{type:"text"}}}},Ke=()=>{const[e,r]=s.useState([]);return p(j,{label:"Last opp fil",tip:"Maks 1",required:!0,initialFiles:e,onChange:t=>{r(t)},maxFiles:1})},Ye=()=>{const[e,r]=s.useState([]);return p(j,{label:"Last opp PDF",tip:"Kun pdf-filer. Maks 2",required:!0,initialFiles:e,onChange:t=>{r(t)},accept:[".pdf","application/pdf"],maxFiles:2})},Je=()=>{const[e,r]=s.useState([]),[t,o]=s.useState("");return s.useEffect(()=>{setTimeout(()=>{o("Feilmelding som kommer etter 3 sek.")},3e3)},[]),p(j,{label:"Last opp",tip:"Maks 2",required:!0,initialFiles:e,onChange:i=>{r(i)},errorMessage:t,maxFiles:2})},R=()=>z(ge,{title:"FileUploader - overview",children:[p(Ke,{}),p(Ye,{}),p(Je,{})]});var ie,ae,ne;R.parameters={...R.parameters,docs:{...(ie=R.parameters)==null?void 0:ie.docs,source:{originalSource:`() => {
  return <StoryTemplate title="FileUploader - overview">
      <SingleFileUploader />
      <PdfUploader />
      <WithErrorMessage />
    </StoryTemplate>;
}`,...(ne=(ae=R.parameters)==null?void 0:ae.docs)==null?void 0:ne.source}}};const Qe=["Overview"],pr=Object.freeze(Object.defineProperty({__proto__:null,Overview:R,__namedExportsOrder:Qe,default:He},Symbol.toStringTag,{value:"Module"}));export{pr as F,R as O};
//# sourceMappingURL=FileUploader.stories-9f25ce24.js.map
