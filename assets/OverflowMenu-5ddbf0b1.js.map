{"version":3,"file":"OverflowMenu-5ddbf0b1.js","sources":["../../../../packages/components/src/components/OverflowMenu/OverflowMenu.tsx"],"sourcesContent":["import { forwardRef, useEffect, useId } from 'react';\nimport styled from 'styled-components';\nimport { selection, visibilityTransition } from '../../helpers/styling';\nimport { scrollbarStyling } from '../ScrollableContainer';\nimport {\n  useCombinedRef,\n  useOnClickOutside,\n  useOnKeyDown,\n  useFloatPosition,\n  useRoveFocus,\n} from '../../hooks';\nimport { OverflowMenuItem } from './OverflowMenuItem';\nimport { overflowMenuTokens as tokens } from './OverflowMenu.tokens';\nimport { Divider } from '../Divider';\nimport {\n  OverflowMenuContextItem,\n  OverflowMenuNavItem,\n  OverflowMenuProps,\n} from '.';\nimport { getBaseHTMLProps } from '../../types';\nimport { PersonIcon } from '../../icons/tsx';\n\nconst { container, divider } = tokens;\n\ntype ContainerProps = { isOpen: boolean };\n\nexport const Container = styled.div<ContainerProps>`\n  box-sizing: border-box;\n  z-index: 100;\n  overflow-y: auto;\n  min-width: 180px;\n  max-width: 300px;\n  ${({ isOpen }) => visibilityTransition(isOpen)}\n  border: ${container.border};\n  background-color: ${container.backgroundColor};\n  border-radius: ${container.borderRadius};\n\n  ${scrollbarStyling.webkit}\n  ${scrollbarStyling.firefox}\n\n  *::selection {\n    ${selection}\n  }\n`;\n\nexport const OverflowMenuList = styled.ul`\n  display: flex;\n  flex-direction: column;\n  list-style-type: none;\n  padding: 0;\n  margin: 0;\n`;\n\nconst StyledDivider = styled(Divider)`\n  margin-left: ${divider.marginLeft};\n  margin-right: ${divider.marginRight};\n`;\n\nexport const OverflowMenu = forwardRef<HTMLDivElement, OverflowMenuProps>(\n  (props, ref) => {\n    const {\n      anchorRef,\n      onClose,\n      onToggle,\n      isOpen = false,\n      placement = 'bottom-end',\n      items,\n      navItems,\n      userProps,\n      id,\n      offset = tokens.offset,\n      className,\n      htmlProps = {},\n      ...rest\n    } = props;\n\n    const { reference, floating, refs, styles } = useFloatPosition(null, {\n      placement,\n      offset,\n    });\n\n    const combinedRef = useCombinedRef(ref, floating);\n\n    useEffect(() => {\n      anchorRef ? reference(anchorRef.current) : reference(null);\n    }, [anchorRef]);\n\n    useOnClickOutside(\n      [refs?.floating?.current, refs?.reference?.current as HTMLElement | null],\n      () => {\n        if (isOpen) {\n          onClose && onClose();\n          onToggle && onToggle();\n        }\n      }\n    );\n\n    useOnKeyDown(['Esc', 'Escape'], () => {\n      if (isOpen) {\n        onClose && onClose();\n        onToggle && onToggle();\n        anchorRef && anchorRef.current?.focus();\n      }\n    });\n\n    useOnKeyDown(['Tab'], () => {\n      if (isOpen) {\n        onClose && onClose();\n        onToggle && onToggle();\n      }\n    });\n\n    const interactiveItems: (OverflowMenuContextItem | OverflowMenuNavItem)[] =\n      [];\n\n    const hasContextItems = !!items && items.length > 0;\n    const hasNavItems = !!navItems && navItems.length > 0;\n    const { name: username, ...userPropsRest } = userProps || {};\n    const hasStaticUser =\n      username && userProps && !userProps.href && !userProps.onClick;\n    const hasInteractiveUser =\n      username && userProps && (!!userProps.href || !!userProps.onClick);\n\n    hasInteractiveUser &&\n      interactiveItems.push({ title: username, ...userPropsRest });\n    hasNavItems && interactiveItems.push(...navItems);\n    hasContextItems && interactiveItems.push(...items);\n\n    const hasInteractiveItems = interactiveItems.length > 0;\n\n    const [focus, setFocus] = useRoveFocus(\n      interactiveItems && interactiveItems.length,\n      !isOpen\n    );\n\n    const interactiveItemsList = hasInteractiveItems\n      ? interactiveItems.map((item, index) => (\n          <li key={index}>\n            <OverflowMenuItem\n              index={index}\n              focus={focus === index && isOpen}\n              setFocus={setFocus}\n              icon={hasInteractiveUser && index === 0 ? PersonIcon : undefined}\n              {...item}\n              onClick={(\n                e: React.MouseEvent<HTMLAnchorElement, MouseEvent> &\n                  React.MouseEvent<HTMLButtonElement, MouseEvent>\n              ) => {\n                item.onClick && item.onClick(e);\n                onToggle && onToggle();\n                onClose && onClose();\n              }}\n            />\n          </li>\n        ))\n      : null;\n\n    const interactiveContent = () => {\n      if (hasInteractiveItems) {\n        const userPropsPos = hasInteractiveUser ? 0 : -1;\n        const navItemsFirstPos = hasNavItems ? userPropsPos + 1 : -1;\n        const navItemsLastPos = hasNavItems\n          ? userPropsPos + navItems.length\n          : -1;\n        const contextItemsFirstPos = !hasContextItems\n          ? -1\n          : hasNavItems\n          ? navItemsLastPos + 1\n          : userPropsPos + 1;\n        return (\n          <>\n            {hasInteractiveUser && (\n              <OverflowMenuList>{interactiveItemsList?.[0]}</OverflowMenuList>\n            )}\n            {hasNavItems && (\n              <nav>\n                <OverflowMenuList>\n                  {interactiveItemsList?.slice(\n                    navItemsFirstPos,\n                    navItemsLastPos + 1\n                  )}\n                </OverflowMenuList>\n              </nav>\n            )}\n            {hasNavItems && hasContextItems && (\n              <StyledDivider color=\"primaryLighter\" />\n            )}\n            {hasContextItems && (\n              <OverflowMenuList aria-label=\"kontekstmeny\">\n                {interactiveItemsList?.slice(\n                  contextItemsFirstPos,\n                  interactiveItemsList.length\n                )}\n              </OverflowMenuList>\n            )}\n          </>\n        );\n      }\n    };\n\n    const { style = {}, ...restHTMLProps } = htmlProps;\n    const generatedId = useId();\n\n    const containerProps = {\n      ...getBaseHTMLProps(id, className, restHTMLProps, rest),\n      ref: combinedRef,\n      id: id ?? `${generatedId}-overflowMenu`,\n      isOpen,\n      style: { ...style, ...styles.floating },\n      'aria-hidden': !isOpen,\n      role: 'menu',\n    };\n\n    return (\n      <Container {...containerProps} aria-label=\"bruk piltaster for Ã¥ navigere\">\n        {hasStaticUser && (\n          <OverflowMenuItem title={username} icon={PersonIcon} />\n        )}\n\n        {interactiveContent()}\n      </Container>\n    );\n  }\n);\n\nOverflowMenu.displayName = 'OverflowMenu';\n"],"names":["container","divider","tokens","Container","styled","isOpen","visibilityTransition","scrollbarStyling","selection","OverflowMenuList","StyledDivider","Divider","OverflowMenu","forwardRef","props","ref","anchorRef","onClose","onToggle","placement","items","navItems","userProps","id","offset","className","htmlProps","rest","reference","floating","refs","styles","useFloatPosition","combinedRef","useCombinedRef","useEffect","useOnClickOutside","_a","_b","useOnKeyDown","interactiveItems","hasContextItems","hasNavItems","username","userPropsRest","hasStaticUser","hasInteractiveUser","hasInteractiveItems","focus","setFocus","useRoveFocus","interactiveItemsList","item","index","jsx","OverflowMenuItem","PersonIcon","e","interactiveContent","userPropsPos","navItemsFirstPos","navItemsLastPos","contextItemsFirstPos","jsxs","Fragment","style","restHTMLProps","generatedId","useId","containerProps","getBaseHTMLProps"],"mappings":"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"}