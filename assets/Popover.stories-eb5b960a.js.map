{"version":3,"file":"Popover.stories-eb5b960a.js","sources":["../../../../packages/components/src/hooks/useReturnFocusOnBlur.ts","../../../../packages/components/src/components/Popover/Popover.tokens.tsx","../../../../packages/components/src/components/Popover/Popover.tsx","../../../../packages/components/src/components/Popover/PopoverGroup.tsx"],"sourcesContent":["import { RefObject, useEffect, useRef } from 'react';\nimport { getFocusableElements } from '../utils';\n\n/**\n * Returnerer fokus til et element når første eller siste barn i en container mister fokus ved tastaturnavigasjon. Typisk bruk:\n * ```\n * const MyComponent = (props) => {\n *\n *  const [isOpen, setOpen] = useState(true);\n *  const close = () => setOpen(false);\n *  const triggerRef = useRef<HTMLButtonElement>(null);\n *  const containerRef = useReturnFocusOnBlur<HTMLDivElement>(\n *    isOpen,\n *    triggerRef.current,\n *    () => close()\n *  );\n *\n *  return (\n *    <div>\n *      <button ref={triggerRef} >Åpne popover</button>\n *      <div ref={containerRef}>\n *        <button>gjør noe</button>\n *      </div>\n *    </div>\n *  )\n * }\n * ```\n * @param active om container skal få fokus, f.eks. når en modal åpnes.\n * @param triggerElement elementet som skal få fokus når fokus forlater container.\n * @param onBlur ekstra logikk når fokus forlater container.\n * @returns ref til container som får fokus.\n */\n\nexport function useReturnFocusOnBlur<T extends HTMLElement>(\n  active: boolean,\n  onBlur: () => void,\n  triggerElement?: HTMLElement | null\n): RefObject<T> {\n  const elementRef = useRef<T>(null);\n\n  useEffect(() => {\n    function handleFocus(e: KeyboardEvent) {\n      if (e.key !== 'Tab' || !active || !elementRef.current || !triggerElement)\n        return;\n\n      const focusableElements = getFocusableElements(elementRef);\n      const lastElement = focusableElements[focusableElements.length - 1];\n      const firstElement = focusableElements[0];\n\n      if (\n        (!e.shiftKey && document.activeElement === lastElement) ||\n        (e.shiftKey && document.activeElement === firstElement) ||\n        (e.shiftKey && document.activeElement === element)\n      ) {\n        triggerElement.focus();\n        e.preventDefault();\n        onBlur();\n      }\n    }\n\n    const element = elementRef.current;\n    if (element && active) {\n      element.focus();\n      element.addEventListener('keydown', handleFocus);\n    }\n\n    return () => {\n      element?.removeEventListener('keydown', handleFocus);\n    };\n  }, [active]);\n\n  return elementRef;\n}\n","import { ddsBaseTokens } from '@norges-domstoler/dds-design-tokens';\n\nconst { spacing } = ddsBaseTokens;\n\nconst wrapper = {\n  padding: `${spacing.SizesDdsSpacingLocalX075} ${spacing.SizesDdsSpacingLocalX1} ${spacing.SizesDdsSpacingLocalX15} ${spacing.SizesDdsSpacingLocalX1}`,\n};\nconst closeButton = {\n  top: spacing.SizesDdsSpacingLocalX025,\n  right: spacing.SizesDdsSpacingLocalX025,\n};\n\nconst title = {\n  marginRight: spacing.SizesDdsSpacingLocalX2,\n};\n\nconst content = {\n  noTitle: {\n    marginTop: spacing.SizesDdsSpacingLocalX2,\n  },\n};\n\nexport const popoverTokens = {\n  content,\n  wrapper,\n  closeButton,\n  title,\n};\n","import { ddsBaseTokens } from '@norges-domstoler/dds-design-tokens';\nimport { Property } from 'csstype';\nimport { forwardRef, ReactNode, useEffect } from 'react';\nimport styled, { css } from 'styled-components';\nimport { focusVisible, visibilityTransition } from '../../helpers/styling';\nimport {\n  Placement,\n  useCombinedRef,\n  useFloatPosition,\n  useReturnFocusOnBlur,\n  useMountTransition,\n  useOnClickOutside,\n} from '../../hooks';\nimport { BaseComponentPropsWithChildren, getBaseHTMLProps } from '../../types';\nimport { Button } from '../Button';\nimport { Typography } from '../Typography';\nimport { popoverTokens as tokens } from './Popover.tokens';\nimport { CloseIcon } from '../../icons/tsx';\nimport { Paper } from '../../helpers';\n\nconst { spacing: Spacing } = ddsBaseTokens;\nconst { wrapper, content, closeButton, title } = tokens;\n\ntype WrapperProps = {\n  sizeProps?: PopoverSizeProps;\n  hasTransitionedIn?: boolean;\n  isOpen: boolean;\n};\n\nconst Wrapper = styled(Paper)<WrapperProps>`\n  opacity: 0;\n  ${({ hasTransitionedIn, isOpen }) =>\n    hasTransitionedIn && visibilityTransition(hasTransitionedIn && isOpen)}\n  position: absolute;\n  width: fit-content;\n  z-index: 100;\n  padding: ${wrapper.padding};\n\n  &:focus-visible {\n    ${focusVisible}\n  }\n  ${({ sizeProps }) =>\n    sizeProps &&\n    css`\n      ${sizeProps}\n    `}\n`;\n\nconst TitleContainer = styled.div`\n  margin-right: ${title.marginRight};\n`;\n\ntype ContentContainerProps = {\n  hasTitle: boolean;\n  withCloseButton: boolean;\n};\n\nconst ContentContainer = styled.div<ContentContainerProps>`\n  ${({ withCloseButton, hasTitle }) =>\n    withCloseButton &&\n    !hasTitle &&\n    css`\n      margin-top: ${content.noTitle.marginTop};\n    `}\n`;\n\nconst StyledButton = styled(Button)`\n  position: absolute;\n  top: ${closeButton.top};\n  right: ${closeButton.right};\n`;\n\nexport type PopoverSizeProps = {\n  width?: Property.Width<string>;\n  height?: Property.Height<string>;\n  minWidth?: Property.MinWidth<string>;\n  minHeight?: Property.MinHeight<string>;\n  maxWidth?: Property.MaxWidth<string>;\n  maxHeight?: Property.MaxHeight<string>;\n};\n\nexport type PopoverProps = BaseComponentPropsWithChildren<\n  HTMLDivElement,\n  {\n    /**Tittel. */\n    title?: string | ReactNode;\n    /** **OBS!** Propen settes automatisk av `<PopoverGroup />`. Spesifiserer om `<Popover />` skal vises. */\n    isOpen?: boolean;\n    /**Om lukkeknapp skal vises. */\n    withCloseButton?: boolean;\n    /** **OBS!** Propen settes automatisk av `<PopoverGroup />`. Anchor-elementet. */\n    anchorElement?: HTMLElement;\n    /**Spesifiserer hvor komponenten skal plasseres i forhold til anchor-elementet. */\n    placement?: Placement;\n    /**Avstand fra anchor-elementet i px. */\n    offset?: number;\n    /** Ekstra logikk kjørt når lukkeknappen trykkes. */\n    onCloseButtonClick?: () => void;\n    /** Ekstra logikk kjørt når popover mister fokus. */\n    onBlur?: () => void;\n    /**Custom størrelse. */\n    sizeProps?: PopoverSizeProps;\n    /** **OBS!** Propen settes automatisk av `<PopoverGroup />`. Funksjon kjørt ved lukking. */\n    onClose?: () => void;\n  }\n>;\n\nexport const Popover = forwardRef<HTMLDivElement, PopoverProps>(\n  (props, ref) => {\n    const {\n      title,\n      isOpen = false,\n      withCloseButton = true,\n      onBlur,\n      onCloseButtonClick,\n      onClose,\n      anchorElement,\n      children,\n      placement = 'bottom',\n      offset = Spacing.SizesDdsSpacingLocalX05NumberPx,\n      id,\n      className,\n      htmlProps = {},\n      ...rest\n    } = props;\n\n    const popoverRef = useReturnFocusOnBlur(\n      isOpen,\n      () => {\n        onClose && onClose();\n        onBlur && onBlur();\n      },\n      anchorElement && anchorElement\n    );\n\n    const { reference, floating, styles } = useFloatPosition(null, {\n      placement,\n      offset,\n    });\n    const multiRef = useCombinedRef(ref, popoverRef, floating);\n\n    useEffect(() => {\n      anchorElement ? reference(anchorElement) : reference(null);\n    }, [anchorElement]);\n\n    const elements: (HTMLElement | null)[] = [\n      popoverRef.current as HTMLElement,\n    ];\n    if (anchorElement) elements.push(anchorElement);\n\n    useOnClickOutside(elements, () => {\n      if (isOpen) onClose && onClose();\n    });\n\n    const hasTransitionedIn = useMountTransition(isOpen, 400);\n\n    const wrapperProps = {\n      ...getBaseHTMLProps(id, className, htmlProps, rest),\n      ref: multiRef,\n      isOpen,\n      hasTransitionedIn,\n      tabIndex: -1,\n      style: { ...htmlProps.style, ...styles.floating },\n      role: 'dialog',\n    };\n\n    return isOpen || hasTransitionedIn ? (\n      <Wrapper {...wrapperProps} elevation={3} border=\"light\">\n        {title && (\n          <TitleContainer>\n            {typeof title === 'string' ? (\n              <Typography typographyType=\"headingSans02\">{title}</Typography>\n            ) : (\n              title\n            )}\n          </TitleContainer>\n        )}\n        <ContentContainer hasTitle={!!title} withCloseButton={withCloseButton}>\n          {children}\n        </ContentContainer>\n        {withCloseButton && (\n          <StyledButton\n            icon={CloseIcon}\n            appearance=\"borderless\"\n            purpose=\"secondary\"\n            size=\"small\"\n            onClick={onCloseButtonClick}\n            aria-label=\"Lukk\"\n          />\n        )}\n      </Wrapper>\n    ) : null;\n  }\n);\n\nPopover.displayName = 'Popover';\n","import {\n  useState,\n  ReactElement,\n  Children as ReactChildren,\n  cloneElement,\n  isValidElement,\n  useRef,\n  ReactNode,\n  useId,\n} from 'react';\nimport { useOnKeyDown } from '../../hooks';\n\nexport type PopoverGroupProps = {\n  /**Callback når det trykkes på lukkeknappen. */\n  onCloseButtonClick?: () => void;\n  /** Callback når det trykkes på anchor-elementet (trigger-elementet). */\n  onTriggerClick?: () => void;\n  /**Forteller `<Popover />` om den skal være åpen.  */\n  isOpen?: boolean;\n  /** `id` til `<Popover />.` */\n  popoverId?: string;\n  /** Barna til wrapperen: anchor-element som det første og `<Popover />` so det adnre.  */\n  children: ReactNode;\n};\n\nexport const PopoverGroup = ({\n  isOpen = false,\n  onCloseButtonClick,\n  onTriggerClick,\n  children,\n  popoverId,\n}: PopoverGroupProps) => {\n  const [open, setOpen] = useState(isOpen);\n\n  const generatedId = useId();\n  const uniquePopoverId = popoverId ?? `${generatedId}-popover`;\n\n  const handleOnCloseButtonClick = () => {\n    setOpen(false);\n    onCloseButtonClick && onCloseButtonClick();\n  };\n\n  const handleOnTriggerClick = () => {\n    setOpen(!open);\n    onTriggerClick && onTriggerClick();\n  };\n\n  const buttonRef = useRef<HTMLElement>(null);\n  const popoverRef = useRef<HTMLDivElement>(null);\n\n  useOnKeyDown(['Esc', 'Escape'], () => {\n    if (open) {\n      setOpen(false);\n      buttonRef.current?.focus();\n    }\n  });\n\n  const handleClose = () => setOpen(false);\n\n  const Children = ReactChildren.map(children, (child, childIndex) => {\n    return (\n      isValidElement(child) &&\n      (childIndex === 0\n        ? cloneElement(child as ReactElement, {\n            'aria-haspopup': 'dialog',\n            'aria-controls': uniquePopoverId,\n            'aria-expanded': open,\n            onClick: handleOnTriggerClick,\n            ref: buttonRef,\n          })\n        : cloneElement(child as ReactElement, {\n            isOpen: open,\n            'aria-hidden': !open,\n            id: uniquePopoverId,\n            onCloseButtonClick: handleOnCloseButtonClick,\n            anchorElement: buttonRef.current,\n            ref: popoverRef,\n            onClose: handleClose,\n          }))\n    );\n  });\n\n  return <>{Children}</>;\n};\n\nPopoverGroup.displayName = 'PopoverGroup';\n"],"names":["useReturnFocusOnBlur","active","onBlur","triggerElement","elementRef","useRef","useEffect","handleFocus","e","focusableElements","getFocusableElements","lastElement","firstElement","element","spacing","ddsBaseTokens","wrapper","closeButton","title","content","popoverTokens","Spacing","tokens","Wrapper","styled","Paper","hasTransitionedIn","isOpen","visibilityTransition","focusVisible","sizeProps","css","TitleContainer","ContentContainer","withCloseButton","hasTitle","StyledButton","Button","Popover","forwardRef","props","ref","onCloseButtonClick","onClose","anchorElement","children","placement","offset","id","className","htmlProps","rest","popoverRef","reference","floating","styles","useFloatPosition","multiRef","useCombinedRef","elements","useOnClickOutside","useMountTransition","wrapperProps","getBaseHTMLProps","jsxs","jsx","Typography","CloseIcon","PopoverGroup","onTriggerClick","popoverId","open","setOpen","useState","generatedId","useId","uniquePopoverId","handleOnCloseButtonClick","handleOnTriggerClick","buttonRef","useOnKeyDown","_a","handleClose","Children","ReactChildren","child","childIndex","isValidElement","cloneElement"],"mappings":"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"}