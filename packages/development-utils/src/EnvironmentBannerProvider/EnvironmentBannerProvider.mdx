import { Canvas, Controls, Meta } from '@storybook/addon-docs/blocks';
import { Default } from './EnvironmentBannerProvider.stories';

<Meta title="development-utils/EnvironmentBannerProvider" />

# EnvironmentBannerProvider

Denne komponenten kan brukes for 친 hjelpe utviklere/testere med 친 se hvilket milj칮 de jobber i. Den viser en banner (med unik farge per milj칮) 칮verst p친 siden med milj칮navnet.
I produksjon (ved `environment="PROD"`) eller ved et ukjent milj칮 er den skjult, s친 du trenger ikke 친 h친ndtere skjuling av banneren.

<Canvas of={Default} />
<Controls of={Default} />

## 游댣 Bruk

Denne komponenten m친 wrappes rundt hele applikasjonen.

```tsx
// index.tsx - eller tilsvarende rotkomponent i applikasjonen
import {
  EnvironmentBannerProvider,
  Environment,
} from '@norges-domstoler/development-utils';

const environment: Environment = 'LOKAL'; // Milj칮et applikasjonen kj칮rer i

const root = createRoot(document.getElementById('root') as HTMLElement);
root.render(
  <EnvironmentBannerProvider environment={environment}>
    <App />
  </EnvironmentBannerProvider>,
  document.getElementById('root') as HTMLElement,
);
```

### Hvordan finne milj칮et applikasjonen kj칮rer i?

Dette er opp til hver enkelt konsument, men her kommer noen tips p친 hvordan dette kan l칮ses. Hvordan dette gj칮res vil variere litt p친 hvorvidt applikasjonen din er server-side rendered (SSR) eller client-side rendered (CSR).

#### SSR

Hvis applikasjonen din har SSR anbefaler vi 친 bruke milj칮variabler.
Eksempelet under viser hvordan dette kan gj칮res i Remix.

```tsx
export const loader = () => {
  return {
    // Dette m친 da settes i k8s-applications for applikasjonen
    environment: process.env.ENVIRONMENT as Environment,
  };
};
export default function App() {
  const { environment } = useLoaderData<typeof loader>();
  return (
    <body>
      <EnvironmentBannerProvider environment={environment}>
        <Outlet />
      </EnvironmentBannerProvider>
    </body>
  );
}
```

#### CSR

Ved CSR er det ikke mulig 친 bruke milj칮variabler for 친 skille mellom milj칮et appen kj칮rer i, da du kun har tilgang til milj칮variabler ved bygg av applikasjonen.
Et godt alternativ da er 친 bruke URL-en til applikasjonen p친 친 skille mellom milj칮ene.
Eksempelet under viser hvordan det er gjort for [Saksbehandling Straff](https://github.com/domstolene/saksbehandling-straff/) gjennom `window.location.host`.

```ts
export const getEnvironment = (): Environment => {
  const hostToEnv: Record<string, Environment> = {
    '0.0.0.0:9000': 'LOKAL',
    'saksbehandling-straff.apps.cp.test.domstol.no': 'TEST',
    'saksbehandling-straff.apps.cp.at.domstol.no': 'AT',
    'saksbehandling-straff.apps.cp.ads.domstol.no': 'PROD',
  };

  return hostToEnv[window.location.host] || 'PROD';
};
```
